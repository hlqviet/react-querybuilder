"use strict";var xr=Object.create;var Kt=Object.defineProperty;var Gr=Object.getOwnPropertyDescriptor;var Ar=Object.getOwnPropertyNames;var Or=Object.getPrototypeOf,Cr=Object.prototype.hasOwnProperty;var vr=(e,t)=>{for(var o in t)Kt(e,o,{get:t[o],enumerable:!0})},xn=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Ar(t))!Cr.call(e,n)&&n!==o&&Kt(e,n,{get:()=>t[n],enumerable:!(r=Gr(t,n))||r.enumerable});return e};var Ce=(e,t,o)=>(o=e!=null?xr(Or(e)):{},xn(t||!e||!e.__esModule?Kt(o,"default",{value:e,enumerable:!0}):o,e)),$r=e=>xn(Kt({},"__esModule",{value:!0}),e);var gl={};vr(gl,{ActionElement:()=>ke,DragHandle:()=>Ro,InlineCombinator:()=>Oo,LogType:()=>Ge,NotToggle:()=>vo,QueryBuilder:()=>sr,QueryBuilderContext:()=>tt,QueryBuilderStateContext:()=>dt,QueryBuilderStateProvider:()=>lr,Rule:()=>cn,RuleComponents:()=>ar,RuleGroup:()=>pn,RuleGroupBodyComponents:()=>cr,RuleGroupHeaderComponents:()=>ur,ShiftActions:()=>dn,TestID:()=>k,ValueEditor:()=>mn,ValueSelector:()=>ft,add:()=>ao,convertFromIC:()=>lt,convertQuery:()=>Er,convertToIC:()=>No,default:()=>sr,defaultCELValueProcessor:()=>Ur,defaultCombinators:()=>He,defaultCombinatorsExtended:()=>Sr,defaultControlClassnames:()=>Go,defaultControlElements:()=>Yo,defaultJoinChar:()=>$t,defaultMongoDBValueProcessor:()=>Wr,defaultOperatorNegationMap:()=>Tr,defaultOperators:()=>xo,defaultPlaceholderFieldGroupLabel:()=>$n,defaultPlaceholderFieldLabel:()=>vn,defaultPlaceholderFieldName:()=>Ct,defaultPlaceholderOperatorGroupLabel:()=>Sn,defaultPlaceholderOperatorLabel:()=>Tn,defaultPlaceholderOperatorName:()=>vt,defaultRuleProcessorCEL:()=>at,defaultRuleProcessorElasticSearch:()=>Ft,defaultRuleProcessorJSONata:()=>Bt,defaultRuleProcessorJsonLogic:()=>kt,defaultRuleProcessorMongoDB:()=>it,defaultRuleProcessorParameterized:()=>bt,defaultRuleProcessorSQL:()=>lo,defaultRuleProcessorSpEL:()=>ct,defaultSpELValueProcessor:()=>jr,defaultTranslations:()=>go,defaultValidator:()=>Fr,defaultValueProcessor:()=>qr,defaultValueProcessorByRule:()=>_e,defaultValueProcessorCELByRule:()=>Hr,defaultValueProcessorMongoDBByRule:()=>_r,defaultValueProcessorSpELByRule:()=>Jr,filterFieldsByComparator:()=>Pt,findPath:()=>Re,formatQuery:()=>Vr,generateAccessibleDescription:()=>Vo,generateID:()=>ge,getCommonAncestorPath:()=>Lo,getCompatContextProvider:()=>Yr,getFirstOption:()=>he,getOption:()=>ve,getParentPath:()=>re,getQuerySelectorById:()=>nt,getValidationClassNames:()=>qt,getValueSourcesUtil:()=>qo,groupInvalidReasons:()=>Tt,isAncestor:()=>zr,isFlexibleOptionGroupArray:()=>Te,isFullOptionGroupArray:()=>wr,isOptionGroupArray:()=>Nt,isPojo:()=>ne,isRuleGroup:()=>D,isRuleGroupType:()=>J,isRuleGroupTypeIC:()=>ze,isRuleOrGroupValid:()=>ye,isValidationResult:()=>Qo,joinWith:()=>rt,jsonLogicAdditionalOperators:()=>Qn,mergeClassnames:()=>Lt,mergeTranslations:()=>Mt,messages:()=>Nr,move:()=>Jo,nullFreeArray:()=>Pr,numericRegex:()=>So,objectEntries:()=>Kr,objectKeys:()=>Vt,parseNumber:()=>U,pathIsDisabled:()=>pt,pathsAreEqual:()=>Ve,prepareRule:()=>Uo,prepareRuleGroup:()=>Wt,prepareRuleOrGroup:()=>jo,queryBuilderStore:()=>Zo,regenerateID:()=>Ut,regenerateIDs:()=>jt,remove:()=>_o,rootPath:()=>rr,splitBy:()=>Pn,standardClassnames:()=>w,toArray:()=>V,toFlatOptionArray:()=>Fo,toFullOption:()=>be,toFullOptionList:()=>Qe,toFullOptionMap:()=>Zt,toOptions:()=>zo,transformQuery:()=>ol,trimIfString:()=>q,uniqByIdentifier:()=>Ze,uniqByName:()=>Dr,uniqOptGroups:()=>St,uniqOptList:()=>Eo,update:()=>Ho,useControlledOrUncontrolled:()=>To,useDeprecatedProps:()=>Yt,useMergedContext:()=>Xo,usePreferAnyProp:()=>sl,usePreferProp:()=>_t,usePrevious:()=>$o,useQueryBuilderSchema:()=>on,useQueryBuilderSelector:()=>en,useQueryBuilderSetup:()=>nn,useReactDndWarning:()=>Jt,useRule:()=>rn,useRuleGroup:()=>ln,useSelectElementChangeHandler:()=>sn,useStopEventPropagation:()=>Ae,useValueEditor:()=>an,useValueSelector:()=>un});module.exports=$r(gl);var Gn=Ce(require("react")),ke=e=>Gn.createElement("button",{type:"button","data-testid":e.testID,disabled:e.disabled&&!e.disabledTranslation,className:e.className,title:e.disabledTranslation&&e.disabled?e.disabledTranslation.title:e.title,onClick:t=>e.handleOnClick(t)},e.disabledTranslation&&e.disabled?e.disabledTranslation.label:e.label);var An=Ce(require("react")),On=require("react"),Ro=(0,On.forwardRef)((e,t)=>An.createElement("span",{"data-testid":e.testID,ref:t,className:e.className,title:e.title},e.label));var Ao=Ce(require("react"));var Cn="~",Xt="------",Ct=Cn,vn=Xt,$n=Xt,vt=Cn,Tn=Xt,Sn=Xt,$t=",",go={fields:{title:"Fields",placeholderName:Ct,placeholderLabel:vn,placeholderGroupLabel:$n},operators:{title:"Operators",placeholderName:vt,placeholderLabel:Tn,placeholderGroupLabel:Sn},value:{title:"Value"},removeRule:{label:"\u2A2F",title:"Remove rule"},removeGroup:{label:"\u2A2F",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"\u29C9",title:"Clone rule"},cloneRuleGroup:{label:"\u29C9",title:"Clone group"},shiftActionUp:{label:"\u02C4",title:"Shift up"},shiftActionDown:{label:"\u02C5",title:"Shift down"},dragHandle:{label:"\u205E\u205E",title:"Drag handle"},lockRule:{label:"\u{1F513}",title:"Lock rule"},lockGroup:{label:"\u{1F513}",title:"Lock group"},lockRuleDisabled:{label:"\u{1F512}",title:"Unlock rule"},lockGroupDisabled:{label:"\u{1F512}",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},xo=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],Tr={"=":"!=","!=":"=","<":">=","<=":">",">":"<=",">=":"<",beginsWith:"doesNotBeginWith",doesNotBeginWith:"beginsWith",endsWith:"doesNotEndWith",doesNotEndWith:"endsWith",contains:"doesNotContain",doesNotContain:"contains",between:"notBetween",notBetween:"between",in:"notIn",notIn:"in",notNull:"null",null:"notNull"},He=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],Sr=[...He,{name:"xor",value:"xor",label:"XOR"}],w={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dndCopy:"dndCopy",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item",branches:"queryBuilder-branches"},Go={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},Tt={empty:"empty",invalidCombinator:"invalid combinator",invalidIndependentCombinators:"invalid independent combinators"},k={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},Ge={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",queryUpdate:"query updated",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"};var Oo=e=>{let{component:t,...o}=e;return Ao.createElement("div",{className:w.betweenRules,"data-testid":k.inlineCombinator},Ao.createElement(t,{...o,testID:k.combinators}))};var Co=Ce(require("react")),vo=e=>Co.createElement("label",{"data-testid":e.testID,className:e.className,title:e.title},Co.createElement("input",{type:"checkbox",onChange:t=>e.handleOnChange(t.target.checked),checked:!!e.checked,disabled:e.disabled}),e.label);var mt=Ce(require("react")),nr=require("react-redux");var Nr={errorInvalidIndependentCombinatorsProp:"QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorUnnecessaryIndependentCombinatorsProp:"QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorDeprecatedRuleGroupProps:"A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",errorDeprecatedRuleProps:"A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",errorBothQueryDefaultQuery:"QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",errorUncontrolledToControlled:"QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorControlledToUncontrolled:"QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorEnabledDndWithoutReactDnD:"QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd."};var Nn=require("react"),$o=e=>{let t=(0,Nn.useRef)({value:e,prev:null}),o=t.current.value;return e!==o&&(t.current={value:e,prev:o}),t.current.prev};var To=e=>{let{defaultQuery:t,queryProp:o}=e,r=$o(!!o)};function Yt(e,t,o){}var ot=require("react");var Pn=(e,t=$t)=>typeof e=="string"?e.split(`\\${t}`).map(o=>o.split(t)).reduce((o,r,n)=>n===0?r:[...o.slice(0,o.length-1),`${o[o.length-1]}${t}${r[0]}`,...r.slice(1)],[]):[],rt=(e,t=$t)=>e.map(o=>`${o??""}`.replaceAll(t,`\\${t}`)).join(t),q=e=>typeof e=="string"?e.trim():e,V=e=>Array.isArray(e)?e.map(q):typeof e=="string"?Pn(e,$t).filter(t=>!/^\s*$/.test(t)).map(t=>t.trim()):typeof e=="number"?[e]:[],Pr=e=>e.every(t=>t===!1||(t??!1)!==!1);var En=require("numeric-quantity"),So=new RegExp(En.numericRegex.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),ne=e=>e===null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype;var D=e=>ne(e)&&"rules"in e&&Array.isArray(e.rules),J=e=>D(e)&&typeof e.combinator=="string",ze=e=>D(e)&&typeof e.combinator>"u";var Fn=e=>D(e)?Dn(e):e,Dn=e=>{let t=[],o=n=>t.push(Fn(n)),r=0;for(let n=0;n<e.rules.length;n+=2)if(e.rules.length===1)o(e.rules[0]);else if(e.rules[n+1]==="and"){r=n;let l=1;for(;e.rules[r+l]==="and";)n+=2,l+=2;t.push({rules:e.rules.slice(r,n+1).map(Fn)}),n-=2}else e.rules[n+1]==="or"&&(n===0||n===e.rules.length-3?((n===0||e.rules[n-1]==="or")&&o(e.rules[n]),o(e.rules[n+1]),n===e.rules.length-3&&o(e.rules[n+2])):(e.rules[n-1]==="and"||o(e.rules[n]),o(e.rules[n+1])));return t.length===1&&typeof t[0]=="object"&&D(t[0])?{...e,...t[0]}:{...e,rules:t}},lt=e=>{if(J(e))return e;let t=Dn(e),o=t.rules.map(l=>typeof l=="string"||!D(l)?l:lt(l)),r=o.length<2?"and":o[1],n=o.filter(l=>typeof l!="string");return{...t,combinator:r,rules:n}},No=e=>{if(ze(e))return e;let{combinator:t,...o}=e,r=[],{length:n}=e.rules;return e.rules.forEach((l,s)=>{D(l)?r.push(No(l)):r.push(l),t&&s<n-1&&r.push(t)}),{...o,rules:r}};function Er(e){return ze(e)?lt(e):No(e)}var Fr=e=>{let t={},o=n=>{},r=n=>{let l=[];if(n.rules.length===0)l.push(Tt.empty);else if(!J(n)){let s=!1;for(let a=0;a<n.rules.length&&!s;a++)(a%2===0&&typeof n.rules[a]=="string"||a%2===1&&typeof n.rules[a]!="string"||a%2===1&&typeof n.rules[a]=="string"&&!He.map(u=>u.name).includes(n.rules[a]))&&(s=!0);s&&l.push(Tt.invalidIndependentCombinators)}J(n)&&!He.map(s=>s.name).includes(n.combinator)&&n.rules.length>1&&l.push(Tt.invalidCombinator),n.id&&(l.length?t[n.id]={valid:!1,reasons:l}:t[n.id]=!0),n.rules.forEach(s=>{typeof s=="string"||(D(s)?r(s):o(s))})};return r(e),t};var Po=require("immer");var wn=e=>ne(e)&&"name"in e&&typeof e.name=="string",Bn=e=>ne(e)&&"value"in e&&typeof e.value=="string";function be(e,t){return(0,Po.produce)(r=>{let n={},l=!!t;if(wn(r)&&!Bn(r)?(n.value=r.name,l=!0):!wn(r)&&Bn(r)&&(n.name=r.value,l=!0),l)return Object.assign({},t,r,n)})(e)}function Qe(e,t){return Array.isArray(e)?(0,Po.produce)(r=>{if(Te(r))for(let n of r)n.options.forEach((l,s)=>n.options[s]=be(l,t));else r.forEach((n,l)=>r[l]=be(n,t))})(e):[]}function Zt(e,t){return Object.fromEntries(Object.entries(e).map(([o,r])=>[o,be(r,t)]))}var Dr=e=>Ze(e),Ze=e=>{let t=new Set,o=[];return e.forEach(r=>{t.has(r.value??r.name)||(t.add(r.value??r.name),o.push(r))}),e.length===o.length?e:o},St=e=>{let t=new Set,o=new Set,r=[];return e.forEach(n=>{if(!t.has(n.label)){t.add(n.label);let l=[];n.options.forEach(s=>{o.has(s.value??s.name)||(o.add(s.value??s.name),l.push(be(s)))}),r.push({...n,options:l})}}),r},Eo=e=>Te(e)?St(e):Ze(e.map(t=>be(t)));var Nt=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0],Te=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0]&&ne(e[0].options[0])&&("name"in e[0].options[0]||"value"in e[0].options[0]),wr=e=>Array.isArray(e)&&e.length>0&&ne(e[0])&&"options"in e[0]&&ne(e[0].options[0])&&"name"in e[0].options[0]&&ne(e[0].options[0])&&"value"in e[0].options[0],ve=(e,t)=>(Nt(e)?e.flatMap(o=>o.options):e).find(o=>o.name===t),he=e=>!Array.isArray(e)||e.length===0?null:Te(e)?e[0].options[0].value??e[0].options[0].name:e[0].value??e[0].name,Fo=e=>Ze(Nt(e)?e.flatMap(t=>t.options):e);var In=(e,t,o)=>{let r=be(e),n=be(o);return r.value===n.value?!1:typeof r.comparator=="string"?r[r.comparator]===n[r.comparator]:r.comparator?.(n,t)??!1},Pt=(e,t,o)=>{if(!e.comparator){let r=n=>(n.value??n.name)!==(e.value??e.name);return Te(t)?t.map(n=>({...n,options:n.options.filter(r)})):t.filter(r)}return Te(t)?t.map(r=>({...r,options:r.options.filter(n=>In(e,o,n))})).filter(r=>r.options.length>0):t.filter(r=>In(e,o,r))};var kn=require("numeric-quantity"),U=(e,t={})=>{if(!t.parseNumbers||typeof e=="bigint"||typeof e=="number")return e;if(t.parseNumbers==="native")return parseFloat(e);let o=(0,kn.numericQuantity)(e,{allowTrailingInvalid:t.parseNumbers==="enhanced",romanNumerals:!0,round:!1});return isNaN(o)?e:o};var eo=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},Do={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},wo={and:"&&",or:"||"},Qn={startsWith:(e,t)=>typeof e=="string"&&e.startsWith(t),endsWith:(e,t)=>typeof e=="string"&&e.endsWith(t)},Bo=e=>({...e,rules:e.rules.map(t=>{if(typeof t=="string")return t;if(D(t))return Bo(t);let{value:o}=t;return typeof o=="string"&&(o=U(o,{parseNumbers:!0})),{...t,value:o}})}),Be=e=>typeof e=="string"&&e.length>0||typeof e=="number"&&!isNaN(e)||typeof e!="string"&&typeof e!="number",I=(e,t)=>t&&(typeof e=="number"||typeof e=="bigint"||typeof e=="string"&&So.test(e)),Ln=e=>e.length>=3,et=(e=["",""])=>Array.isArray(e)?e:typeof e=="string"?[e,e]:e??["",""],Ke=e=>e===null||typeof e>"u"||e==="";var to=e=>/^(does)?not/i.test(e),st=(e,t)=>typeof e!="string"||!t?e:e.replaceAll('"','\\"'),at=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l}={})=>{let s=r==="field",a=t.replace(/^=$/,"=="),u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||u?q(o):`"${st(o,n)}"`}`;case"contains":case"doesNotContain":return`${to(a)?"!":""}${e}.contains(${s?q(o):`"${st(o,n)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${to(a)?"!":""}${e}.startsWith(${s?q(o):`"${st(o,n)}"`})`;case"endsWith":case"doesNotEndWith":return`${to(a)?"!":""}${e}.endsWith(${s?q(o):`"${st(o,n)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let i=to(a),c=V(o);return`${i?"!(":""}${e} in [${c.map(p=>s||I(p,l)?`${q(p)}`:`"${st(p,n)}"`).join(", ")}]${i?")":""}`}case"between":case"notBetween":{let i=V(o);if(i.length>=2&&!Ke(i[0])&&!Ke(i[1])){let[c,p]=i,y=I(c,!0)?U(c,{parseNumbers:!0}):NaN,f=I(p,!0)?U(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`"${st(c,n)}"`:y,b=isNaN(f)?s?`${p}`:`"${st(p,n)}"`:f;if(h===y&&b===f&&f<y){let S=f;b=y,h=S}return t==="between"?`(${e} >= ${h} && ${e} <= ${b})`:`(${e} < ${h} || ${e} > ${b})`}else return""}}return""};var Le=e=>typeof e!="string"?e:e.replaceAll("\\","\\\\").replaceAll('"','\\"'),it=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{let l=r==="field",s=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,n);if(t==="="&&!l)return`{"${e}":${s?q(o):`"${Le(o)}"`}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let a=Do[t];return l?`{"$expr":{"${a}":["$${e}","$${o}"]}}`:`{"${e}":{"${a}":${s?q(o):`"${Le(o)}"`}}}`}case"contains":return l?`{"$where":"this.${e}.includes(this.${o})"}`:`{"${e}":{"$regex":"${Le(o)}"}}`;case"beginsWith":return l?`{"$where":"this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$regex":"^${Le(o)}"}}`;case"endsWith":return l?`{"$where":"this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$regex":"${Le(o)}$"}}`;case"doesNotContain":return l?`{"$where":"!this.${e}.includes(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${Le(o)}"}}}`;case"doesNotBeginWith":return l?`{"$where":"!this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"^${Le(o)}"}}}`;case"doesNotEndWith":return l?`{"$where":"!this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${Le(o)}$"}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let a=V(o);return l?`{"$where":"${t==="notIn"?"!":""}[${a.map(u=>`this.${u}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${Do[t]}":[${a.map(u=>I(u,n)?`${q(u)}`:`"${Le(u)}"`).join(",")}]}}`}case"between":case"notBetween":{let a=V(o);if(a.length>=2&&Be(a[0])&&Be(a[1])){let[u,i]=a,c=I(u,!0)?U(u,{parseNumbers:!0}):NaN,p=I(i,!0)?U(i,{parseNumbers:!0}):NaN,y=l||!isNaN(c)?`${u}`:`"${Le(u)}"`,f=l||!isNaN(p)?`${i}`:`"${Le(i)}"`;return t==="between"?l?`{"$and":[{"$expr":{"$gte":["$${e}","$${y}"]}},{"$expr":{"$lte":["$${e}","$${f}"]}}]}`:`{"${e}":{"$gte":${y},"$lte":${f}}}`:l?`{"$or":[{"$expr":{"$lt":["$${e}","$${y}"]}},{"$expr":{"$gt":["$${e}","$${f}"]}}]}`:`{"$or":[{"${e}":{"$lt":${y}}},{"${e}":{"$gt":${f}}}]}`}else return""}}return""};var oo=e=>/^(does)?not/i.test(e),Io=(e,t)=>t?`!(${e})`:`${e}`,ut=(e,t)=>typeof e!="string"||!t?e:e.replaceAll("'","\\'"),ct=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l}={})=>{let s=r==="field",a=t.replace(/^=$/,"=="),u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||u?q(o):`'${ut(o,n)}'`}`;case"contains":case"doesNotContain":return Io(`${e} matches ${s||u?q(o):`'${ut(o,n)}'`}`,oo(a));case"beginsWith":case"doesNotBeginWith":{let i=s?`'^'.concat(${q(o)})`:`'${typeof o=="string"&&!o.startsWith("^")||u?"^":""}${ut(o,n)}'`;return Io(`${e} matches ${i}`,oo(a))}case"endsWith":case"doesNotEndWith":{let i=s?`${q(o)}.concat('$')`:`'${ut(o,n)}${typeof o=="string"&&!o.endsWith("$")||u?"$":""}'`;return Io(`${e} matches ${i}`,oo(a))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let i=oo(a)?"!":"",c=V(o);return c.length>0?`${i}(${c.map(p=>`${e} == ${s||I(p,l)?`${q(p)}`:`'${ut(p,n)}'`}`).join(" or ")})`:""}case"between":case"notBetween":{let i=V(o);if(i.length>=2&&!Ke(i[0])&&!Ke(i[1])){let[c,p]=i,y=I(c,!0)?U(c,{parseNumbers:!0}):NaN,f=I(p,!0)?U(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`'${ut(c,n)}'`:y,b=isNaN(f)?s?`${p}`:`'${ut(p,n)}'`:f;if(h===y&&b===f&&f<y){let S=f;b=y,h=S}return t==="between"?`(${e} >= ${h} and ${e} <= ${b})`:`(${e} < ${h} or ${e} > ${b})`}else return""}}return""};var Br=(e,t,o)=>o&&typeof e=="string"?e.replaceAll(`${t}`,`${t}${t}`):e,_e=({operator:e,value:t,valueSource:o},{escapeQuotes:r,parseNumbers:n,quoteFieldNamesWith:l,quoteValuesWith:s}={})=>{let a=o==="field",[u,i]=et(l),c=e.toLowerCase(),p=s||"'",y=b=>Br(b,p,r),f=b=>`${p}${y(b)}${p}`,h=b=>`${u}${b}${i}`;switch(c){case"null":case"notnull":return"";case"in":case"notin":{let b=V(t);return b.length>0?`(${b.map(S=>a?h(S):I(S,n)?`${q(S)}`:`${f(S)}`).join(", ")})`:""}case"between":case"notbetween":{let b=V(t);if(b.length>=2&&Be(b[0])&&Be(b[1])){let[S,B]=b;return a?`${h(S)} and ${h(B)}`:I(S,n)&&I(B,n)?`${q(S)} and ${q(B)}`:`${f(S)} and ${f(B)}`}return""}case"contains":case"doesnotcontain":return a?`${p}%${p} || ${h(t)} || ${p}%${p}`:`${p}%${y(t)}%${p}`;case"beginswith":case"doesnotbeginwith":return a?`${h(t)} || ${p}%${p}`:`${p}${y(t)}%${p}`;case"endswith":case"doesnotendwith":return a?`${p}%${p} || ${h(t)}`:`${p}%${y(t)}${p}`}return typeof t=="boolean"?t?"TRUE":"FALSE":a?h(t):I(t,n)?`${q(t)}`:`${f(t)}`};var Ir={"<":"lt","<=":"lte",">":"gt",">=":"gte"},no=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,ko=e=>e?.replace(/('|\\)/g,"\\$1"),kr={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},Qr=(e,t,o)=>{let r=`doc['${e}'].${kr[t]??t}(doc['${o}'])`;return t.startsWith("d")?`!${r}`:r},Et=(e,t)=>typeof e=="boolean"?e:I(e,t)?U(e,{parseNumbers:t}):e,Ft=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{if(r==="field"){if(V(o).some(s=>typeof s!="string"))return!1;let l=ko(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let s=t==="="?"==":t,a=ko(o);return a?{bool:{filter:{script:{script:`doc['${l}'] ${s} doc['${a}']`}}}}:!1}case"in":case"notIn":{let s=V(o);if(s.length>0){let a=s.map(u=>({bool:{filter:{script:{script:`doc['${l}'] == doc['${u}']`}}}}));return{bool:t==="in"?{should:a}:{must_not:a}}}return!1}case"between":case"notBetween":{let s=V(o);if(s.length>=2&&s[0]&&s[1]){let a=`doc['${l}'] >= doc['${s[0]}'] && doc['${l}'] <= doc['${s[1]}']`;return{bool:{filter:{script:{script:t==="notBetween"?`!(${a})`:a}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let s=ko(o);return s?{bool:{filter:{script:{script:Qr(l,t,s)}}}}:!1}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[Ir[t]]:Et(o,n)}}};case"=":return{term:{[e]:Et(o,n)}};case"!=":return{bool:{must_not:{term:{[e]:Et(o,n)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let l=V(o).map(s=>Et(s,n));if(l.length>0){let s=l.map(a=>({term:{[e]:Et(a,n)}}));return{bool:t==="in"?{should:s}:{must_not:s}}}return!1}case"between":case"notBetween":{let l=V(o);if(l.length>=2&&Be(l[0])&&Be(l[1])){let[s,a]=l;if(I(s,!0)&&I(a,!0)){let u=U(s,{parseNumbers:!0}),i=U(a,{parseNumbers:!0});if(i<u){let c=i;a=u,s=c}else s=u,a=i}return no(t,{range:{[e]:{gte:s,lte:a}}})}return!1}case"contains":case"doesNotContain":return no(t,{regexp:{[e]:{value:o}}});case"beginsWith":case"doesNotBeginWith":return no(t,{regexp:{[e]:{value:`^${o}`}}});case"endsWith":case"doesNotEndWith":return no(t,{regexp:{[e]:{value:`${o}$`}}})}return!1};var ro=e=>/^(does)?not/i.test(e),Dt=(e,t)=>`"${typeof e!="string"||!t?e:e.replaceAll('"','\\"')}"`,wt=(e,t)=>t?`$not(${e})`:`${e}`,Vn=e=>`${e}`.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),Bt=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l=!0,quoteFieldNamesWith:s=["",""]}={})=>{let a=r==="field",u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l),[i,c]=et(s),p=y=>`${i}${y}${c}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${p(e)} ${t} ${a?p(q(o)):u?q(o):Dt(o,n)}`;case"contains":case"doesNotContain":return wt(`$contains(${p(e)}, ${a?p(q(o)):Dt(o,n)})`,ro(t));case"beginsWith":case"doesNotBeginWith":return wt(a?`$substring(${p(e)}, 0, $length(${p(q(o))})) = ${p(q(o))}`:`$contains(${p(e)}, /^${Vn(o)}/)`,ro(t));case"endsWith":case"doesNotEndWith":return wt(a?`$substring(${p(e)}, $length(${p(e)}) - $length(${p(q(o))})) = ${p(q(o))}`:`$contains(${p(e)}, /${Vn(o)}$/)`,ro(t));case"null":return`${p(e)} = null`;case"notNull":return`${p(e)} != null`;case"in":case"notIn":{let y=V(o);return wt(`${p(e)} in [${y.map(f=>a?`${p(q(f))}`:I(f,l)?`${q(f)}`:Dt(f,n)).join(", ")}]`,ro(t))}case"between":case"notBetween":{let y=V(o);if(y.length>=2&&!Ke(y[0])&&!Ke(y[1])){let[f,h]=y,b=I(f,!0)?U(f,{parseNumbers:!0}):NaN,S=I(h,!0)?U(h,{parseNumbers:!0}):NaN,B=isNaN(b)?a?`${f}`:f:b,Q=isNaN(S)?a?`${h}`:h:S;if(B===b&&Q===S&&S<b){let m=S;Q=b,B=m}let F=I(f,l)&&I(h,l),g=`${p(e)} >= ${a?p(f):F?B:Dt(B,n)} and ${p(e)} <= ${a?p(h):F?Q:Dt(Q,n)}`;return t==="between"?`(${g})`:wt(g,!0)}else return""}}return""};var Lr=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),It=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,kt=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{let l=r==="field",s={var:e},a=u=>l?{var:`${u}`}:I(u,n)?U(u,{parseNumbers:n}):u;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[Lr(t)]:[s,a(o)]};case"null":case"notNull":return{[`${t==="notNull"?"!":"="}=`]:[s,null]};case"in":case"notIn":{let u=V(o).map(a);return It(t,{in:[s,u]})}case"between":case"notBetween":{let u=V(o);if(u.length>=2&&Be(u[0])&&Be(u[1])){let[i,c]=u;if(!l&&I(i,!0)&&I(c,!0)){let y=U(i,{parseNumbers:!0}),f=U(c,{parseNumbers:!0});if(f<y){let h=f;c=y,i=h}else i=y,c=f}else l&&(i={var:i},c={var:c});return It(t,{"<=":[i,s,c]})}return!1}case"contains":case"doesNotContain":{let u={in:[a(o),s]};return It(t,u)}case"beginsWith":case"doesNotBeginWith":{let u={startsWith:[s,a(o)]};return It(t,u)}case"endsWith":case"doesNotEndWith":{let u={endsWith:[s,a(o)]};return It(t,u)}}return!1};var bt=(e,t,o)=>{let{fieldData:r,format:n,getNextNamedParam:l,parseNumbers:s,paramPrefix:a,paramsKeepPrefix:u,numberedParams:i,quoteFieldNamesWith:c=["",""],valueProcessor:p=_e}=t??{},{processedParams:y=[]}=o??{},f=n==="parameterized",h=[],b={},S=d=>f?{sql:d,params:h}:{sql:d,params:b},B=p(e,{parseNumbers:s,quoteFieldNamesWith:c,fieldData:r,format:n}),Q=eo(e.operator),F=Q.toLowerCase();if((F==="in"||F==="not in"||F==="between"||F==="not between")&&!B)return S("");if(F==="is null"||F==="is not null")return S(`${c[0]}${e.field}${c[1]} ${Q}`);if(e.valueSource==="field")return S(`${c[0]}${e.field}${c[1]} ${Q} ${B}`.trim());if(F==="in"||F==="not in"){let d=V(e.value);if(f)return d.forEach(x=>h.push(I(x,s)?U(x,{parseNumbers:s}):x)),S(`${c[0]}${e.field}${c[1]} ${Q} (${d.map((x,v)=>i?`${a}${y.length+1+d.length-(d.length-v)}`:"?").join(", ")})`);let G=[];return d.forEach(x=>{let v=l(e.field);G.push(`${a}${v}`),b[`${u?a:""}${v}`]=I(x,s)?U(x,{parseNumbers:s}):x}),S(`${c[0]}${e.field}${c[1]} ${Q} (${G.join(", ")})`)}else if(F==="between"||F==="not between"){let d=V(e.value),[G,x]=d.slice(0,2).map(N=>I(N,s)?U(N,{parseNumbers:s}):N);if(f)return h.push(G),h.push(x),S(`${c[0]}${e.field}${c[1]} ${Q} ${i?`${a}${y.length+1}`:"?"} and ${i?`${a}${y.length+2}`:"?"}`);let v=l(e.field),R=l(e.field);return b[`${u?a:""}${v}`]=G,b[`${u?a:""}${R}`]=x,S(`${c[0]}${e.field}${c[1]} ${Q} ${a}${v} and ${a}${R}`)}let g=e.value;typeof e.value=="string"&&(I(e.value,s)?g=U(e.value,{parseNumbers:s}):g=/^'.*'$/g.test(B)?B.replace(/(^'|'$)/g,""):B);let m="";return f?h.push(g):(m=l(e.field),b[`${u?a:""}${m}`]=g),S(`${c[0]}${e.field}${c[1]} ${Q} ${f?i?`${a}${y.length+1}`:"?":`${a}${m}`}`.trim())};var lo=(e,t)=>{let{parseNumbers:o,escapeQuotes:r,quoteFieldNamesWith:n=["",""],quoteValuesWith:l="'",valueProcessor:s=_e}=t??{},a=s(e,{parseNumbers:o,escapeQuotes:r,quoteFieldNamesWith:n,quoteValuesWith:l}),u=eo(e.operator),i=u.toLowerCase();if((i==="in"||i==="not in"||i==="between"||i==="not between")&&!a)return"";let[c,p]=et(n);return`${c}${e.field}${p} ${u} ${a}`.trim()};var Qo=e=>ne(e)&&typeof e.valid=="boolean",ye=(e,t,o)=>{if(typeof t=="boolean")return t;if(Qo(t))return t.valid;if(typeof o=="function"&&!D(e)){let r=o(e);if(typeof r=="boolean")return r;if(Qo(r))return r.valid}return!0};function Vr(e,t={}){let o="json",r=_e,n=null,l=["",""],s=()=>!0,a=[],u={},i="",c=":",p=!1,y=!1,f=!1,h=Ct,b=vt,S="'";if(typeof t=="string")o=t.toLowerCase(),o==="mongodb"?n=it:o==="parameterized"?n=bt:o==="parameterized_named"?n=bt:o==="cel"?n=at:o==="spel"?n=ct:o==="jsonlogic"?n=kt:o==="elasticsearch"?n=Ft:o==="jsonata"&&(n=Bt);else{o=(t.format??"json").toLowerCase();let{valueProcessor:g=null,ruleProcessor:m=null}=t;typeof m=="function"&&(n=m),r=typeof g=="function"?(d,G)=>Ln(g)?g(d.field,d.operator,d.value,d.valueSource):g(d,G):o==="mongodb"?n??it:o==="cel"?n??at:o==="spel"?n??ct:o==="jsonlogic"?n??kt:o==="elasticsearch"?n??Ft:o==="jsonata"?n??Bt:_e,l=et(t.quoteFieldNamesWith),s=t.validator??(()=>!0),a=Qe(t.fields??[]),i=t.fallbackExpression??"",c=t.paramPrefix??":",p=!!t.paramsKeepPrefix,y=!!t.numberedParams,f=!!t.parseNumbers,h=t.placeholderFieldName??Ct,b=t.placeholderOperatorName??vt,S=t.quoteValuesWith??"'"}if(i||(i=o==="mongodb"?'"$and":[{"$expr":true}]':o==="cel"||o==="spel"?"1 == 1":"(1 = 1)"),o==="json"||o==="json_without_ids"){let g=f?Bo(e):e;return o==="json"?JSON.stringify(g,null,2):JSON.stringify(g,(m,d)=>m==="id"||m==="path"?void 0:d)}if(typeof s=="function"){let g=s(e);if(typeof g=="boolean"){if(g===!1)return o==="parameterized"?{sql:i,params:[]}:o==="parameterized_named"?{sql:i,params:{}}:o==="mongodb"?`{${i}}`:o==="jsonlogic"?!1:o==="elasticsearch"?{}:i}else u=g}let B={},Q=Fo(a);Q.forEach(g=>{typeof g.validator=="function"&&(B[g.value??g.name]=g.validator)});let F=g=>{let m,d;if(g.id&&(m=u[g.id]),Q.length){let G=Q.filter(x=>x.name===g.field);if(G.length){let x=G[0];typeof x.validator=="function"&&(d=x.validator)}}return[m,d]};if(o==="sql"){let g=(m,d)=>{if(!ye(m,u[m.id??""]))return d?i:"";let G=m.rules.map(x=>{if(typeof x=="string")return x;if(D(x))return g(x,m.rules.length===1);let[v,R]=F(x);if(!ye(x,v,R)||x.field===h||x.operator===b)return"";let N=(x.valueSource??"value")==="value",$=ve(a,x.field);return typeof n=="function"?n(x,{parseNumbers:f,escapeQuotes:N,quoteFieldNamesWith:l,fieldData:$,format:o,quoteValuesWith:S}):lo(x,{parseNumbers:f,escapeQuotes:N,valueProcessor:r,quoteFieldNamesWith:l,fieldData:$,format:o,quoteValuesWith:S})});return G.length===0?i:`${m.not?"NOT ":""}(${G.filter(Boolean).join(J(m)?` ${m.combinator} `:" ")})`};return g(e,!0)}if(o==="parameterized"||o==="parameterized_named"){let g=o==="parameterized",m=[],d={},G=new Map,x=N=>{G.has(N)||G.set(N,new Set);let $=`${N}_${G.get(N).size+1}`;return G.get(N).add($),$},v=N=>{let[$,z]=F(N);if(!ye(N,$,z)||N.field===h||N.operator===b)return"";let ae=ve(a,N.field),H=Object.fromEntries(Array.from(G.entries()).map(([A,pe])=>[A,Array.from(pe)])),_=(typeof n=="function"?n:bt)(N,{getNextNamedParam:x,fieldParamNames:H,parseNumbers:f,quoteFieldNamesWith:l,fieldData:ae,format:o,paramPrefix:c,paramsKeepPrefix:p,numberedParams:y,fallbackExpression:i,valueProcessor:r,fields:a,placeholderFieldName:h,placeholderOperatorName:b,validator:s},{processedParams:m});if(!ne(_))return"";let{sql:ie,params:O}=_;return typeof ie!="string"||!ie?"":(o==="parameterized"&&Array.isArray(O)?m.push(...O):o==="parameterized_named"&&ne(O)&&(Object.assign(d,O),Object.keys(O).forEach(A=>G.get(N.field)?.add(A))),ie)},R=(N,$)=>{if(!ye(N,u[N.id??""]))return $?i:"";let z=N.rules.map(ae=>typeof ae=="string"?ae:D(ae)?R(ae,N.rules.length===1):v(ae));return z.length===0?i:`${N.not?"NOT ":""}(${z.filter(Boolean).join(J(N)?` ${N.combinator} `:" ")})`};return g?{sql:R(e,!0),params:m}:{sql:R(e,!0),params:d}}if(o==="mongodb"){let g=(G,x)=>{if(!ye(G,u[G.id??""]))return x?i:"";let v=`"$${G.combinator.toLowerCase()}"`,R=!1,N=G.rules.map($=>{if(D($)){let _=g($);return _?(R=!0,/^\{.+\}$/.test(_)?_:`{${_}}`):""}let[z,ae]=F($);if(!ye($,z,ae)||$.field===h||$.operator===b)return"";let H=ve(a,$.field);return(n??r)($,{parseNumbers:f,fieldData:H,format:o})}).filter(Boolean);return N.length>0?N.length===1&&!R?N[0]:`${v}:[${N.join(",")}]`:i},m=J(e)?e:lt(e),d=g(m,!0);return/^\{.+\}$/.test(d)?d:`{${d}}`}if(o==="cel"){let g=(m,d)=>{if(!ye(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return wo[R];if(D(R))return g(R);let[N,$]=F(R);if(!ye(R,N,$)||R.field===h||R.operator===b)return"";let z=ve(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o})}).filter(Boolean).join(J(m)?` ${wo[m.combinator]} `:" "),[x,v]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="spel"){let g=(m,d)=>{if(!ye(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[N,$]=F(R);if(!ye(R,N,$)||R.field===h||R.operator===b)return"";let z=ve(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,v]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="jsonata"){let g=(m,d)=>{if(!ye(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[N,$]=F(R);if(!ye(R,N,$)||R.field===h||R.operator===b)return"";let z=ve(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o,quoteFieldNamesWith:l})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,v]=m.not||!d?[`${m.not?"$not":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="jsonlogic"){let g=J(e)?e:lt(e),m=(d,G)=>{if(!ye(d,u[d.id??""]))return!1;let x=d.rules.map(R=>{if(D(R))return m(R);let[N,$]=F(R);if(!ye(R,N,$)||R.field===h||R.operator===b)return!1;let z=ve(a,R.field);return(n??r)(R,{parseNumbers:f,fieldData:z,format:o})}).filter(Boolean);if(x.length===0)return!1;let v={[d.combinator]:x};return d.not?{"!":v}:v};return m(g,!0)}if(o==="elasticsearch"){let g=J(e)?e:lt(e),m=G=>{if(!ye(G,u[G.id??""]))return!1;let x=G.rules.map(v=>{if(D(v))return m(v);let[R,N]=F(v);if(!ye(v,R,N)||v.field===h||v.operator===b)return!1;let $=ve(a,v.field);return(n??r)(v,{parseNumbers:f,fieldData:$,format:o})}).filter(Boolean);return x.length===0?!1:{bool:G.not?{must_not:G.combinator==="or"?{bool:{should:x}}:x}:{[G.combinator==="or"?"should":"must"]:x}}},d=m(g);return d===!1?{}:d}return""}var Mr={default:_e,mongodb:it,cel:at,spel:ct},so=e=>(t,o,r,n)=>Mr[e]({field:t,operator:o,value:r,valueSource:n},{parseNumbers:!1}),qr=so("default"),Wr=so("mongodb"),Ur=so("cel"),jr=so("spel");var Hr=at,_r=it,Jr=ct;var Re=(e,t)=>{let o=t,r=0;for(;r<e.length&&o&&D(o);){let n=o.rules[e[r]];typeof n!="string"?o=n:o=null,r++}return o},re=e=>e.slice(0,e.length-1),Ve=(e,t)=>e.length===t.length&&e.every((o,r)=>o===t[r]),zr=(e,t)=>e.length<t.length&&RegExp(`^${e.join("-")}`).test(t.join("-")),Lo=(e,t)=>{let o=[],r=re(e),n=re(t),l=0;for(;l<r.length&&l<n.length&&r[l]===n[l];)o.push(n[l]),l++;return o},pt=(e,t)=>{let o=!!t.disabled,r=t,n=0;for(;n<e.length&&!o&&D(r);){let l=r.rules[e[n]];ne(l)&&(D(l)||"field"in l&&l.field)&&(o=!!l.disabled,r=l),n++}return o};var Vo=e=>Ve([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`;var Qt=globalThis.crypto,ge=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(Qt){if(typeof Qt.randomUUID=="function")ge=()=>Qt.randomUUID();else if(typeof Qt.getRandomValues=="function"){let e="89ab",t=new Uint32Array(32);ge=()=>{Qt.getRandomValues(t);let o=(t[0]%16).toString(16);for(let r=1;r<32;r++)r===12?o=`${o}4`:r===16?o=`${o}${e[t[17]%4]}`:o=`${o}${(t[r]%16).toString(16)}`,(r===7||r===11||r===15||r===19)&&(o=`${o}-`);return o}}}var qn=Ce(require("react")),Rt=require("react");var Mo=Ce(require("clsx")),Lt=(...e)=>{let t=o=>(0,Mo.default)(e.filter(Boolean).map(r=>(0,Mo.default)(r[o])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}};var Mn=require("immer");var Vt=Object.keys,Kr=Object.entries;var Xr={},Mt=(...e)=>{let[t,...o]=e;return(0,Mn.produce)(t??Xr,r=>{for(let n of o)n&&Vt(n).forEach(l=>{r[l]={...r[l],...n[l]}})})};var Yr=e=>{let{key:t,controlClassnames:o,controlElements:r,translations:n}=e;return l=>{let s=(0,Rt.useContext)(tt),a=(0,Rt.useMemo)(()=>o?{controlClassnames:Lt(s.controlClassnames,l.controlClassnames,o)}:{},[l.controlClassnames,s.controlClassnames]),u=(0,Rt.useMemo)(()=>Mt(s.translations,n,l.translations),[l.translations,s.translations]),i=(0,Rt.useMemo)(()=>({...s,...a,controlElements:{...s.controlElements,...r,...l.controlElements},translations:u}),[a,u,l.controlElements,s]);return qn.createElement(tt.Provider,{value:i,key:t},l.children)}};var qt=e=>{let t=typeof e=="boolean"?e:typeof e=="object"&&e!==null?e.valid:null;return typeof t=="boolean"?t?w.valid:w.invalid:""};var Zr=["value"],el={name:"name",value:"name",valueSources:null,label:"label"},qo=(e,t,o)=>{let r=e?be(e):el;if(r.valueSources)return typeof r.valueSources=="function"?r.valueSources(t):r.valueSources;if(o){let n=o(r.value,t,{fieldData:be(r)});if(n)return n}return Zr};var Wo=require("immer");var Uo=(e,{idGenerator:t=ge}={})=>(0,Wo.produce)(e,o=>{o.id||(o.id=t())}),Wt=(e,{idGenerator:t=ge}={})=>(0,Wo.produce)(e,o=>{o.id||(o.id=t()),o.rules=o.rules.map(r=>typeof r=="string"?r:D(r)?Wt(r,{idGenerator:t}):Uo(r,{idGenerator:t}))}),jo=(e,{idGenerator:t=ge}={})=>D(e)?Wt(e,{idGenerator:t}):Uo(e,{idGenerator:t});var Ht=require("immer");var Ut=(e,{idGenerator:t=ge}={})=>JSON.parse(JSON.stringify({...e,id:t()})),jt=(e,{idGenerator:t=ge}={})=>{if(!ne(e))return e;if(!D(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(J(e)){let r=e.rules.map(n=>D(n)?jt(n,{idGenerator:t}):Ut(n,{idGenerator:t}));return{...e,id:t(),rules:r}}let o=e.rules.map(r=>typeof r=="string"?r:D(r)?jt(r,{idGenerator:t}):Ut(r,{idGenerator:t}));return{...e,id:t(),rules:o}};var ao=(e,t,o,{combinators:r=He,combinatorPreceding:n,idGenerator:l=ge}={})=>(0,Ht.produce)(e,s=>{let a=Re(o,s);if(!(!a||!D(a))){if(!J(a)&&a.rules.length>0){let u=a.rules[a.rules.length-2];a.rules.push(n??(typeof u=="string"?u:he(r)))}a.rules.push(jo(t,{idGenerator:l}))}}),Ho=(e,t,o,r,{resetOnFieldChange:n=!0,resetOnOperatorChange:l=!1,getRuleDefaultOperator:s=()=>"=",getValueSources:a=()=>["value"],getRuleDefaultValue:u=()=>""}={})=>(0,Ht.produce)(e,i=>{if(t==="combinator"&&!J(i)){let b=Re(re(r),i).rules;r[r.length-1]%2===1&&(b[r[r.length-1]]=o);return}let c=Re(r,i);if(!c)return;let p=D(c);if(c[t]===o||(t!=="valueSource"&&(c[t]=o),p))return;let y=!1,f=!1;n&&t==="field"&&(c.operator=s(o),y=!0,f=!0),l&&t==="operator"&&(y=!0,f=!0);let h=a(c.field,c.operator)[0];(y&&c.valueSource&&h!==c.valueSource||t==="valueSource"&&o!==c.valueSource)&&(f=!!c.valueSource||!c.valueSource&&o!==h,c.valueSource=y?h:o),f&&(c.value=u(c))}),_o=(e,t)=>t.length===0||!J(e)&&!Re(t,e)?e:(0,Ht.produce)(e,o=>{let r=t[t.length-1],n=Re(re(t),o);if(n&&D(n))if(!J(n)&&n.rules.length>1){let l=r===0?0:r-1;n.rules.splice(l,2)}else n.rules.splice(r,1)}),tl=(e,t,o)=>{if(Array.isArray(o))return o;let r=ze(e);if(o==="up"){if(Ve(t,[0]))return t;if(t.at(-1)===0){let n=re(t);return[...re(n),Math.max(0,n.at(-1)-(r?1:0))]}else{let n=[...re(t),Math.max(0,t.at(-1)-(r?2:1))],l=Re(n,e);return D(l)?[...n,l.rules.length]:[...re(t),Math.max(0,t.at(-1)-(r?3:1))]}}else if(o==="down"){if(Ve([e.rules.length-1],t))return t;if(t.at(-1)===Re(re(t),e).rules.length-1){let n=re(t);return[...re(n),n.at(-1)+1]}else{let n=[...re(t),t.at(-1)+(r?2:1)],l=Re(n,e);return D(l)?[...n,0]:[...re(t),t.at(-1)+(r?3:2)]}}return t},Jo=(e,t,o,{clone:r=!1,combinators:n=He,idGenerator:l=ge}={})=>{let s=tl(e,t,o);if(t.length===0||Ve(t,s)||!Re(re(s),e))return e;let a=Re(t,e);if(!a)return e;let u=r?D(a)?jt(a,{idGenerator:l}):Ut(a,{idGenerator:l}):a;return(0,Ht.produce)(e,i=>{let c=ze(i),p=Re(re(t),i),y=t[t.length-1],f=c&&y>0?p.rules[y-1]:null,h=c&&y<p.rules.length-1?p.rules[y+1]:null;if(!r){let m=c?Math.max(0,y-1):y,d=c?2:1;p.rules.splice(m,d)}let b=[...s],S=Lo(t,s);!r&&t.length===S.length+1&&s[S.length]>t[S.length]&&(b[S.length]-=c?2:1);let B=re(b),Q=Re(B,i),F=b[b.length-1],g=(...m)=>Q.rules.splice(F,0,...m);if(Q.rules.length===0||!c)g(u);else if(F===0)if(y===0&&h)g(u,h);else{let m=Q.rules[1]||f||he(n);g(u,m)}else if(f)g(f,u);else{let m=Q.rules[F-2]||h||he(n);g(m,u)}})};var io=Ce(require("react"));var zo=e=>Nt(e)?e.map(t=>io.createElement("optgroup",{key:t.label,label:t.label},t.options.map(o=>io.createElement("option",{key:o.name,value:o.name,disabled:o.disabled},o.label)))):Array.isArray(e)?e.map(t=>io.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)):null;var Un=require("immer");var Wn=(e,t,o)=>(0,Un.produce)(e,r=>{for(let[n,l]of Object.entries(t))l===!1?delete r[n]:l&&n!==l&&n in r&&(r[l]=r[n],o&&delete r[n])});function ol(e,t={}){let{ruleProcessor:o=c=>c,ruleGroupProcessor:r=c=>c,propertyMap:n={},combinatorMap:l={},operatorMap:s={},omitPath:a=!1,deleteRemappedProperties:u=!0}=t,i=c=>({...r(Wn({...c,...J(c)?{combinator:l[c.combinator]??c.combinator}:{}},n,u)),...n.rules===!1?null:{[n.rules??"rules"]:c.rules.map((p,y)=>{let f=a?null:{path:[...c.path,y]};return typeof p=="string"?l[p]??p:D(p)?i({...p,...f}):o(Wn({...p,...f,..."operator"in p?{operator:s[p.operator]??p.operator}:{}},n,u))})}});return i({...e,...a?null:{path:[]}})}var Ko=require("react"),nl=(e,t)=>e===!1?!1:e?!0:t!==!1,rl=(e,t)=>e?!0:e===!1?!1:!!t,ll=(e,t,o)=>e?nl(t,o):rl(t,o),_t=(e,t,o)=>(0,Ko.useMemo)(()=>ll(e,t,o),[o,e,t]),sl=(e,t,o)=>(0,Ko.useMemo)(()=>typeof t<"u"&&t!=null?t:typeof o<"u"&&o!=null?o:e,[o,e,t]);var C=()=>null,jn=(0,ot.forwardRef)(C),Xo=e=>{let t=(0,ot.useContext)(tt),o=_t(!0,e.enableMountQueryChange,t.enableMountQueryChange),r=_t(!1,e.enableDragAndDrop,t.enableDragAndDrop)&&t.enableDragAndDrop!==!1,n=_t(!1,e.debugMode,t.debugMode),l=(0,ot.useMemo)(()=>Lt(Go,t.controlClassnames,e.controlClassnames),[t.controlClassnames,e.controlClassnames]),s=(0,ot.useMemo)(()=>{let b={...t.controlElements,...t.controlElements?.dragHandle===null?{dragHandle:jn}:{},...t.controlElements?.inlineCombinator===null?{inlineCombinator:C}:{},...t.controlElements?.notToggle===null?{notToggle:C}:{},...t.controlElements?.shiftActions===null?{shiftActions:C}:{},...t.controlElements?.valueEditor===null?{valueEditor:C}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...t.controlElements?.addGroupAction===null?{addGroupAction:C}:{},...t.controlElements?.addRuleAction===null?{addRuleAction:C}:{},...t.controlElements?.cloneGroupAction===null?{cloneGroupAction:C}:{},...t.controlElements?.cloneRuleAction===null?{cloneRuleAction:C}:{},...t.controlElements?.lockGroupAction===null?{lockGroupAction:C}:{},...t.controlElements?.lockRuleAction===null?{lockRuleAction:C}:{},...t.controlElements?.removeGroupAction===null?{removeGroupAction:C}:{},...t.controlElements?.removeRuleAction===null?{removeRuleAction:C}:{},...t.controlElements?.combinatorSelector===null?{combinatorSelector:C}:{},...t.controlElements?.fieldSelector===null?{fieldSelector:C}:{},...t.controlElements?.operatorSelector===null?{operatorSelector:C}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...t.controlElements?.actionElement?{addGroupAction:t.controlElements?.addGroupAction===null?C:t.controlElements?.addGroupAction??t.controlElements.actionElement,addRuleAction:t.controlElements?.addRuleAction===null?C:t.controlElements?.addRuleAction??t.controlElements.actionElement,cloneGroupAction:t.controlElements?.cloneGroupAction===null?C:t.controlElements?.cloneGroupAction??t.controlElements.actionElement,cloneRuleAction:t.controlElements?.cloneRuleAction===null?C:t.controlElements?.cloneRuleAction??t.controlElements.actionElement,lockGroupAction:t.controlElements?.lockGroupAction===null?C:t.controlElements?.lockGroupAction??t.controlElements.actionElement,lockRuleAction:t.controlElements?.lockRuleAction===null?C:t.controlElements?.lockRuleAction??t.controlElements.actionElement,removeGroupAction:t.controlElements?.removeGroupAction===null?C:t.controlElements?.removeGroupAction??t.controlElements.actionElement,removeRuleAction:t.controlElements?.removeRuleAction===null?C:t.controlElements?.removeRuleAction??t.controlElements.actionElement}:{},...t.controlElements?.valueSelector?{combinatorSelector:t.controlElements?.combinatorSelector===null?C:t.controlElements?.combinatorSelector??t.controlElements.valueSelector,fieldSelector:t.controlElements?.fieldSelector===null?C:t.controlElements?.fieldSelector??t.controlElements.valueSelector,operatorSelector:t.controlElements?.operatorSelector===null?C:t.controlElements?.operatorSelector??t.controlElements.valueSelector,valueSourceSelector:t.controlElements?.valueSourceSelector===null?C:t.controlElements?.valueSourceSelector??t.controlElements.valueSelector}:{}},S={...e.controlElements,...e.controlElements?.dragHandle===null?{dragHandle:jn}:{},...e.controlElements?.inlineCombinator===null?{inlineCombinator:C}:{},...e.controlElements?.notToggle===null?{notToggle:C}:{},...e.controlElements?.shiftActions===null?{shiftActions:C}:{},...e.controlElements?.valueEditor===null?{valueEditor:C}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...e.controlElements?.addGroupAction===null?{addGroupAction:C}:{},...e.controlElements?.addRuleAction===null?{addRuleAction:C}:{},...e.controlElements?.cloneGroupAction===null?{cloneGroupAction:C}:{},...e.controlElements?.cloneRuleAction===null?{cloneRuleAction:C}:{},...e.controlElements?.lockGroupAction===null?{lockGroupAction:C}:{},...e.controlElements?.lockRuleAction===null?{lockRuleAction:C}:{},...e.controlElements?.removeGroupAction===null?{removeGroupAction:C}:{},...e.controlElements?.removeRuleAction===null?{removeRuleAction:C}:{},...e.controlElements?.combinatorSelector===null?{combinatorSelector:C}:{},...e.controlElements?.fieldSelector===null?{fieldSelector:C}:{},...e.controlElements?.operatorSelector===null?{operatorSelector:C}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...e.controlElements?.actionElement?{addGroupAction:e.controlElements?.addGroupAction===null?C:e.controlElements?.addGroupAction??e.controlElements.actionElement,addRuleAction:e.controlElements?.addRuleAction===null?C:e.controlElements?.addRuleAction??e.controlElements.actionElement,cloneGroupAction:e.controlElements?.cloneGroupAction===null?C:e.controlElements?.cloneGroupAction??e.controlElements.actionElement,cloneRuleAction:e.controlElements?.cloneRuleAction===null?C:e.controlElements?.cloneRuleAction??e.controlElements.actionElement,lockGroupAction:e.controlElements?.lockGroupAction===null?C:e.controlElements?.lockGroupAction??e.controlElements.actionElement,lockRuleAction:e.controlElements?.lockRuleAction===null?C:e.controlElements?.lockRuleAction??e.controlElements.actionElement,removeGroupAction:e.controlElements?.removeGroupAction===null?C:e.controlElements?.removeGroupAction??e.controlElements.actionElement,removeRuleAction:e.controlElements?.removeRuleAction===null?C:e.controlElements?.removeRuleAction??e.controlElements.actionElement}:{},...e.controlElements?.valueSelector?{combinatorSelector:e.controlElements?.combinatorSelector===null?C:e.controlElements?.combinatorSelector??e.controlElements.valueSelector,fieldSelector:e.controlElements?.fieldSelector===null?C:e.controlElements?.fieldSelector??e.controlElements.valueSelector,operatorSelector:e.controlElements?.operatorSelector===null?C:e.controlElements?.operatorSelector??e.controlElements.valueSelector,valueSourceSelector:e.controlElements?.valueSourceSelector===null?C:e.controlElements?.valueSourceSelector??e.controlElements.valueSelector}:{}};return{...Yo,...b,...S}},[e.controlElements,t.controlElements]),a=(0,ot.useMemo)(()=>Mt(go,t.translations,e.translations),[e.translations,t.translations]),{controlClassnames:u,controlElements:i,debugMode:c,enableDragAndDrop:p,enableMountQueryChange:y,translations:f,...h}=t;return{controlClassnames:l,controlElements:s,debugMode:n,enableDragAndDrop:r,enableMountQueryChange:o,translations:a,...h}};var tn=require("clsx"),Z=require("react");var Hn=require("@reduxjs/toolkit"),al={},gt=(0,Hn.createSlice)({name:"queries",initialState:al,reducers:{setQueryState:(e,{payload:{qbId:t,query:o}})=>{e[t]=o}},selectors:{getQuerySelectorById:(e,t)=>e[t]}});var _n=require("@reduxjs/toolkit"),Jn=Ce(require("react")),zn=require("react-redux");var il={queries:gt.getInitialState()},Zo=(0,_n.configureStore)({reducer:{queries:gt.reducer},preloadedState:il,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),dt=Jn.createContext(null),en=(0,zn.createSelectorHook)(dt),nt=e=>t=>gt.selectors.getQuerySelectorById(t,e);var uo=require("react-redux"),co=({payload:e,onQueryChange:t})=>o=>{o(gt.actions.setQueryState(e)),typeof t=="function"&&t(e.query)},Kn=(0,uo.createDispatchHook)(dt),Xn=(0,uo.createStoreHook)(dt);var ul={},cl={},pl=()=>null,dl=()=>"",ml=()=>"",fl=e=>e,yl=e=>e,hl=()=>!0,bl=(...e)=>{console.log(...e)};function on(e,t){let{query:o,defaultQuery:r,getValueEditorSeparator:n=pl,getRuleClassname:l=dl,getRuleGroupClassname:s=ml,onAddRule:a=fl,onAddGroup:u=yl,onRemove:i=hl,onQueryChange:c,showCombinatorsBetweenRules:p=!1,showNotToggle:y=!1,showShiftActions:f=!1,showCloneButtons:h=!1,showLockButtons:b=!1,resetOnFieldChange:S=!0,resetOnOperatorChange:B=!1,autoSelectField:Q=!0,autoSelectOperator:F=!0,addRuleToNewGroups:g=!1,listsAsArrays:m=!1,parseNumbers:d=!1,disabled:G=!1,validator:x,onLog:v=bl,idGenerator:R,accessibleDescriptionGenerator:N=Vo}=e,{qbId:$,rqbContext:z,fields:ae,fieldMap:H,combinators:_,getOperatorsMain:ie,getRuleDefaultOperator:O,getValueEditorTypeMain:A,getValueSourcesMain:pe,getValuesMain:We,getRuleDefaultValue:Ue,getInputTypeMain:je,createRule:Ie,createRuleGroup:Ne}=t,{controlClassnames:Pe,controlElements:L,debugMode:X,enableDragAndDrop:xe,enableMountQueryChange:Je,translations:P}=z,T=!!p,E=!!y,de=!!f,me=!!h,Xe=!!b,Ee=!!S,Ye=!!B,te=!!Q,oe=!!F,Oe=!!g,yt=!!m,K=Xn(),Fe=Kn(),ht=(0,Z.useMemo)(()=>nt(t.qbId),[t.qbId]),fo=en(ht),fn=(0,Z.useCallback)(()=>ht(K.getState()),[K,ht]),dr=(0,Z.useMemo)(()=>Ne(),[Ne]),yo=o??fo??r??dr,De=yo.id?yo:Wt(yo,{idGenerator:R});(0,Z.useEffect)(()=>{o&&o!==fo&&Fe(co({payload:{qbId:$,query:o},onQueryChange:void 0}))},[o,$,fo,Fe]);let Gt=(0,Z.useMemo)(()=>ze(De),[De]),ho=!!e.independentCombinators&&!Gt;ho||!ho&&e.independentCombinators,(0,Z.useEffect)(()=>{Fe(co({payload:{qbId:$,query:De},onQueryChange:Je&&typeof c=="function"?c:void 0}))},[]);let we=(0,Z.useCallback)(M=>{Fe(co({payload:{qbId:$,query:M},onQueryChange:c}))},[c,$,Fe]),zt=(0,Z.useMemo)(()=>Array.isArray(G)&&G||[],[G]),$e=G===!0,mr=(0,Z.useMemo)(()=>De.disabled||zt.some(M=>M.length===0),[zt,De.disabled]),yn=(0,Z.useCallback)((M,Y,ue)=>{let W=nt($)(K.getState());if(!W)return;if(pt(Y,W)||$e){X&&v({type:Ge.parentPathDisabled,rule:M,parentPath:Y,query:W});return}let fe=a(M,Y,W,ue);if(!fe){X&&v({type:Ge.onAddRuleFalse,rule:M,parentPath:Y,query:W});return}let Ot=ao(W,fe,Y,{combinators:_,combinatorPreceding:fe.combinatorPreceding??void 0});X&&v({type:Ge.add,query:W,newQuery:Ot,newRule:fe,parentPath:Y}),we(Ot)},[_,X,we,a,v,$,$e,K]),hn=(0,Z.useCallback)((M,Y,ue)=>{let W=nt($)(K.getState());if(!W)return;if(pt(Y,W)||$e){X&&v({type:Ge.parentPathDisabled,ruleGroup:M,parentPath:Y,query:W});return}let fe=u(M,Y,W,ue);if(!fe){X&&v({type:Ge.onAddGroupFalse,ruleGroup:M,parentPath:Y,query:W});return}let Ot=ao(W,fe,Y,{combinators:_,combinatorPreceding:fe.combinatorPreceding??void 0});X&&v({type:Ge.add,query:W,newQuery:Ot,newGroup:fe,parentPath:Y}),we(Ot)},[_,X,we,u,v,$,$e,K]),bn=(0,Z.useCallback)((M,Y,ue)=>{let W=nt($)(K.getState());if(!W)return;if(pt(ue,W)&&M!=="disabled"||$e){X&&v({type:Ge.pathDisabled,path:ue,prop:M,value:Y,query:W});return}let fe=Ho(W,M,Y,ue,{resetOnFieldChange:Ee,resetOnOperatorChange:Ye,getRuleDefaultOperator:O,getValueSources:pe,getRuleDefaultValue:Ue});X&&v({type:Ge.update,query:W,newQuery:fe,prop:M,value:Y,path:ue}),we(fe)},[X,we,O,Ue,pe,v,$,$e,K,Ee,Ye]),bo=(0,Z.useCallback)((M,Y)=>{let ue=nt($)(K.getState());if(!ue)return;if(pt(M,ue)||$e){X&&v({type:Ge.pathDisabled,path:M,query:ue});return}let W=Re(M,ue);if(W)if(i(W,M,ue,Y)){let fe=_o(ue,M);X&&v({type:Ge.remove,query:ue,newQuery:fe,path:M,ruleOrGroup:W}),we(fe)}else X&&v({type:Ge.onRemoveFalse,ruleOrGroup:W,path:M,query:ue})},[X,we,v,i,$,$e,K]),Rn=(0,Z.useCallback)((M,Y,ue)=>{let W=nt($)(K.getState());if(!W)return;if(pt(M,W)||$e){X&&v({type:Ge.pathDisabled,oldPath:M,newPath:Y,query:W});return}let fe=Jo(W,M,Y,{clone:ue,combinators:_});X&&v({type:Ge.move,query:W,newQuery:fe,oldPath:M,newPath:Y,clone:ue}),we(fe)},[_,X,we,v,$,$e,K]),fr=(0,Z.useMemo)(()=>xe?"enabled":"disabled",[xe]),yr=(0,Z.useMemo)(()=>Gt||T?"enabled":"disabled",[Gt,T]),hr=(0,Z.useMemo)(()=>J(De)?{combinator:De.combinator}:{},[De]),{validationResult:At,validationMap:gn}=(0,Z.useMemo)(()=>{let M=typeof x=="function"&&De?x(De):ul;return{validationResult:M,validationMap:typeof M=="boolean"?cl:M}},[De,x]),br=(0,Z.useMemo)(()=>({addRuleToNewGroups:Oe,accessibleDescriptionGenerator:N,autoSelectField:te,autoSelectOperator:oe,classNames:Pe,combinators:_,controls:L,createRule:Ie,createRuleGroup:Ne,disabledPaths:zt,enableDragAndDrop:xe,fieldMap:H,fields:ae,dispatchQuery:we,getQuery:fn,getInputType:je,getOperators:ie,getRuleClassname:l,getRuleGroupClassname:s,getValueEditorSeparator:n,getValueEditorType:A,getValues:We,getValueSources:pe,independentCombinators:Gt,listsAsArrays:yt,parseNumbers:d,qbId:$,showCloneButtons:me,showCombinatorsBetweenRules:T,showLockButtons:Xe,showNotToggle:E,showShiftActions:de,validationMap:gn}),[Oe,N,te,oe,_,Pe,L,Ie,Ne,zt,xe,H,ae,we,fn,je,ie,l,s,A,We,pe,n,Gt,yt,d,$,me,T,Xe,E,de,gn]),Rr=(0,Z.useMemo)(()=>({moveRule:Rn,onGroupAdd:hn,onGroupRemove:bo,onPropChange:bn,onRuleAdd:yn,onRuleRemove:bo}),[Rn,hn,bn,yn,bo]),gr=(0,Z.useMemo)(()=>(0,tn.clsx)(w.queryBuilder,(0,tn.clsx)(Pe.queryBuilder),{[w.disabled]:$e,[w.valid]:typeof At=="boolean"&&At,[w.invalid]:typeof At=="boolean"&&!At}),[Pe.queryBuilder,$e,At]);return{...e,actions:Rr,rootGroup:De,rootGroupDisabled:mr,queryDisabled:$e,rqbContext:z,schema:br,translations:P,wrapperClassName:gr,dndEnabledAttr:fr,inlineCombinatorsAttr:yr,combinatorPropObject:hr}}var ce=require("react");var Yn=(e,t,o)=>{let r=he(e);if(t.operator==="between"||t.operator==="notBetween"){let n=[r,r];return o?n:rt(n.map(l=>l??""),",")}return r},nn=e=>{let[t]=(0,ce.useState)(ge),{query:o,defaultQuery:r,fields:n,baseField:l,operators:s,baseOperator:a,combinators:u=He,baseCombinator:i,translations:c,enableMountQueryChange:p=!0,controlClassnames:y,controlElements:f,getDefaultField:h,getDefaultOperator:b,getDefaultValue:S,getOperators:B,getValueEditorType:Q,getValueSources:F,getInputType:g,getValues:m,autoSelectField:d=!0,autoSelectOperator:G=!0,addRuleToNewGroups:x=!1,enableDragAndDrop:v,listsAsArrays:R=!1,debugMode:N=!1,idGenerator:$=ge}=e,z=s??xo,ae=Xo({controlClassnames:y,controlElements:f,debugMode:N,enableDragAndDrop:v,enableMountQueryChange:p,translations:c}),{translations:H}=ae,_=(0,ce.useMemo)(()=>({id:H.fields.placeholderName,name:H.fields.placeholderName,value:H.fields.placeholderName,label:H.fields.placeholderLabel}),[H.fields.placeholderLabel,H.fields.placeholderName]),ie=(0,ce.useMemo)(()=>n??[_],[_,n]),O=(0,ce.useMemo)(()=>{let P=Array.isArray(ie)?Qe(ie,l):Vt(Zt(ie,l)).map(T=>({...ie[T],name:T,value:T})).sort((T,E)=>T.label.localeCompare(E.label));return Te(P)?d?St(P):St([{label:H.fields.placeholderGroupLabel,options:[_]},...P]):d?Ze(P):Ze([_,...P])},[d,l,_,ie,H.fields.placeholderGroupLabel]),A=(0,ce.useMemo)(()=>{if(!Array.isArray(ie)){let T=Zt(ie,l);return d?T:{...T,[H.fields.placeholderName]:_}}let P={};return Te(O)?O.forEach(T=>T.options.forEach(E=>{P[E.value??E.name]=be(E,l)})):O.forEach(T=>{P[T.value??T.name]=be(T,l)}),P},[d,l,_,O,ie,H.fields.placeholderName]),pe=(0,ce.useMemo)(()=>Qe(u,i),[i,u]),We=(0,ce.useMemo)(()=>({id:H.operators.placeholderName,name:H.operators.placeholderName,value:H.operators.placeholderName,label:H.operators.placeholderLabel}),[H.operators.placeholderLabel,H.operators.placeholderName]),Ue=(0,ce.useCallback)((P,{fieldData:T})=>{let E=Qe(z,a);if(T?.operators)E=Qe(T.operators,a);else if(B){let de=B(P,{fieldData:T});de&&(E=Qe(de,a))}return G||(Te(E)?E=[{label:H.operators.placeholderGroupLabel,options:[We]},...E]:E=[We,...E]),Eo(E)},[G,a,We,B,z,H.operators.placeholderGroupLabel]),je=(0,ce.useCallback)(P=>{let T=A[P];if(T?.defaultOperator)return T.defaultOperator;if(b)return typeof b=="function"?b(P,{fieldData:T}):b;let E=Ue(P,{fieldData:T})??[];return he(E)??""},[A,b,Ue]),Ie=(0,ce.useCallback)((P,T,{fieldData:E})=>E.valueEditorType?typeof E.valueEditorType=="function"?E.valueEditorType(T):E.valueEditorType:Q?.(P,T,{fieldData:E})??"text",[Q]),Ne=(0,ce.useCallback)((P,T)=>qo(A[P],T,F),[A,F]),Pe=(0,ce.useCallback)((P,T,{fieldData:E})=>E?.values?Qe(E.values):m?Qe(m(P,T,{fieldData:E})):[],[m]),L=(0,ce.useCallback)(P=>{let T=A[P.field]??{};if(T?.defaultValue!==void 0&&T.defaultValue!==null)return T.defaultValue;if(S)return S(P,{fieldData:T});let E="",de=Pe(P.field,P.operator,{fieldData:T});if(P.valueSource==="field"){let me=Pt(T,O,P.operator);me.length>0?E=Yn(me,P,R):E=""}else if(de.length){let me=Ie(P.field,P.operator,{fieldData:T});me==="multiselect"?E=R?[]:"":(me==="select"||me==="radio")&&(E=Yn(de,P,R))}else Ie(P.field,P.operator,{fieldData:T})==="checkbox"&&(E=!1);return E},[A,O,S,Ie,Pe,R]),X=(0,ce.useCallback)((P,T,{fieldData:E})=>{if(g){let de=g(P,T,{fieldData:E});if(de)return de}return"text"},[g]),xe=(0,ce.useCallback)(()=>{let P="",T=O;if(T?.length>0&&T[0]){let Ee=he(T);Ee&&(P=Ee)}if(h)if(typeof h=="function"){let Ee=h(T);Ee&&(P=Ee)}else P=h;let E=je(P),de=Ne(P,E)[0]??"value",me={id:$(),field:P,operator:E,valueSource:de,value:""},Xe=L(me);return{...me,value:Xe}},[O,h,je,L,Ne,$]),Je=(0,ce.useCallback)(P=>P?{id:$(),rules:x?[xe()]:[],not:!1}:{id:$(),rules:x?[xe()]:[],combinator:he(pe)??"",not:!1},[x,pe,xe,$]);return To({defaultQuery:r,queryProp:o}),{qbId:t,rqbContext:ae,fields:O,fieldMap:A,combinators:pe,getOperatorsMain:Ue,getRuleDefaultOperator:je,getValueEditorTypeMain:Ie,getValueSourcesMain:Ne,getValuesMain:Pe,getRuleDefaultValue:L,getInputTypeMain:X,createRule:xe,createRuleGroup:Je}};var Jt=(e,t)=>{};var Me=require("clsx"),ee=require("react");var rn=e=>{let{id:t,path:o,rule:r,schema:n,actions:{moveRule:l,onPropChange:s,onRuleRemove:a},disabled:u,parentDisabled:i,shiftUpDisabled:c,shiftDownDisabled:p,field:y,operator:f,value:h,valueSource:b,dragMonitorId:S="",dropMonitorId:B="",dndRef:Q=null,dragRef:F=null,isDragging:g=!1,isOver:m=!1}=e,{classNames:d,fields:G,fieldMap:x,getInputType:v,getOperators:R,getValueEditorType:N,getValueEditorSeparator:$,getValueSources:z,getValues:ae,validationMap:H,enableDragAndDrop:_,getRuleClassname:ie}=n;Jt(_,!!(S||B||Q||F));let O=!!i||!!u,A=(0,ee.useMemo)(()=>r||{id:t,field:y??"",operator:f??"",value:h,valueSource:b},[y,t,f,r,h,b]),pe=(0,ee.useMemo)(()=>({shiftActions:(0,Me.clsx)(w.shiftActions,d.shiftActions),dragHandle:(0,Me.clsx)(w.dragHandle,d.dragHandle),fields:(0,Me.clsx)(w.fields,d.valueSelector,d.fields),operators:(0,Me.clsx)(w.operators,d.valueSelector,d.operators),valueSource:(0,Me.clsx)(w.valueSource,d.valueSelector,d.valueSource),value:(0,Me.clsx)(w.value,d.value),cloneRule:(0,Me.clsx)(w.cloneRule,d.actionElement,d.cloneRule),lockRule:(0,Me.clsx)(w.lockRule,d.actionElement,d.lockRule),removeRule:(0,Me.clsx)(w.removeRule,d.actionElement,d.removeRule)}),[d.shiftActions,d.dragHandle,d.valueSelector,d.fields,d.operators,d.valueSource,d.value,d.actionElement,d.cloneRule,d.lockRule,d.removeRule]),We=(0,ee.useCallback)(K=>(Fe,ht)=>{O||s(K,Fe,o)},[O,s,o]),Ue=(0,ee.useCallback)((K,Fe)=>{if(!O){let ht=[...re(o),o[o.length-1]+1];l(o,ht,!0)}},[O,l,o]),je=(0,ee.useCallback)((K,Fe)=>{s("disabled",!O,o)},[O,s,o]),Ie=(0,ee.useCallback)((K,Fe)=>{O||a(o)},[O,a,o]),Ne=(0,ee.useCallback)((K,Fe)=>{!O&&!c&&l(o,"up",K?.altKey)},[O,l,o,c]),Pe=(0,ee.useCallback)((K,Fe)=>{!O&&!p&&l(o,"down",K?.altKey)},[O,l,o,p]),L=(0,ee.useMemo)(()=>x?.[A.field]??{name:A.field,value:A.field,label:A.field},[x,A.field]),X=(0,ee.useMemo)(()=>L.inputType??v(A.field,A.operator,{fieldData:L}),[L,v,A.field,A.operator]),xe=(0,ee.useMemo)(()=>R(A.field,{fieldData:L}),[L,R,A.field]),Je=(0,ee.useMemo)(()=>ve(xe,A.operator),[xe,A.operator]),P=Je?.arity,T=typeof P=="string"&&P==="unary"||typeof P=="number"&&P<2,E=(0,ee.useMemo)(()=>typeof L.valueSources=="function"?L.valueSources(A.operator):L.valueSources??z(A.field,A.operator,{fieldData:L}),[L,z,A.field,A.operator]),de=(0,ee.useMemo)(()=>A.valueSource==="field"?"select":N(A.field,A.operator,{fieldData:L}),[L,N,A.field,A.operator,A.valueSource]),me=(0,ee.useMemo)(()=>$(A.field,A.operator,{fieldData:L}),[L,$,A.field,A.operator]),Xe=(0,ee.useMemo)(()=>A.valueSource==="field"?Pt(L,G,A.operator):L.values??ae(A.field,A.operator,{fieldData:L}),[L,G,ae,A.field,A.operator,A.valueSource]),Ee=(0,ee.useMemo)(()=>E.map(K=>({name:K,value:K,label:K})),[E]),Ye=(0,ee.useMemo)(()=>H[t??""]??(typeof L.validator=="function"?L.validator(A):null),[L,t,A,H]),te=(0,ee.useMemo)(()=>qt(Ye),[Ye]),oe=(0,ee.useMemo)(()=>L?.className??"",[L?.className]),Oe=(0,ee.useMemo)(()=>Je?.className??"",[Je?.className]),yt=(0,Me.clsx)(ie(A,{fieldData:L}),oe,Oe,w.rule,d.rule,{[w.disabled]:O,[w.dndDragging]:g,[w.dndOver]:m},te);return{...e,classNames:pe,cloneRule:Ue,disabled:O,dndRef:Q,dragMonitorId:S,dragRef:F,dropMonitorId:B,fieldData:L,generateOnChangeHandler:We,hideValueControls:T,inputType:X,operators:xe,outerClassName:yt,removeRule:Ie,rule:A,shiftRuleUp:Ne,shiftRuleDown:Pe,toggleLockRule:je,validationResult:Ye,valueEditorSeparator:me,valueEditorType:de,values:Xe,valueSourceOptions:Ee,valueSources:E}};var Se=require("clsx"),le=require("react");var ln=e=>{let{id:t,path:o,ruleGroup:r,schema:{qbId:n,accessibleDescriptionGenerator:l,classNames:s,combinators:a,createRule:u,createRuleGroup:i,disabledPaths:c,independentCombinators:p,validationMap:y,enableDragAndDrop:f,getRuleGroupClassname:h},actions:{onGroupAdd:b,onGroupRemove:S,onPropChange:B,onRuleAdd:Q,moveRule:F},disabled:g,parentDisabled:m,shiftUpDisabled:d,shiftDownDisabled:G,combinator:x,rules:v,not:R,dragMonitorId:N="",dropMonitorId:$="",previewRef:z=null,dragRef:ae=null,dropRef:H=null,isDragging:_=!1,isOver:ie=!1}=e;Jt(f,!!(N||$||z||ae||H));let O=!!m||!!g,A=(0,le.useMemo)(()=>r&&J(r)?r.combinator:r?he(a):x??he(a),[x,a,r]),pe=(0,le.useMemo)(()=>r?{...r,...p?{}:{combinator:A}}:{rules:v,not:R},[A,p,R,r,v]),We=(0,le.useMemo)(()=>({header:(0,Se.clsx)(w.header,s.header,{[w.dndOver]:ie}),shiftActions:(0,Se.clsx)(w.shiftActions,s.shiftActions),dragHandle:(0,Se.clsx)(w.dragHandle,s.dragHandle),combinators:(0,Se.clsx)(w.combinators,s.valueSelector,s.combinators),notToggle:(0,Se.clsx)(w.notToggle,s.notToggle),addRule:(0,Se.clsx)(w.addRule,s.actionElement,s.addRule),addGroup:(0,Se.clsx)(w.addGroup,s.actionElement,s.addGroup),cloneGroup:(0,Se.clsx)(w.cloneGroup,s.actionElement,s.cloneGroup),lockGroup:(0,Se.clsx)(w.lockGroup,s.actionElement,s.lockGroup),removeGroup:(0,Se.clsx)(w.removeGroup,s.actionElement,s.removeGroup),body:(0,Se.clsx)(w.body,s.body)}),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.combinators,s.dragHandle,s.header,s.lockGroup,s.notToggle,s.removeGroup,s.shiftActions,s.valueSelector,ie]),Ue=(0,le.useCallback)((te,oe)=>{O||B("combinator",te,o)},[O,B,o]),je=(0,le.useCallback)((te,oe,Oe)=>{O||B("combinator",te,o.concat([oe]))},[O,B,o]),Ie=(0,le.useCallback)((te,oe)=>{O||B("not",te,o)},[O,B,o]),Ne=(0,le.useCallback)((te,oe)=>{if(!O){let Oe=u();Q(Oe,o,oe)}},[u,O,Q,o]),Pe=(0,le.useCallback)((te,oe)=>{if(!O){let Oe=i(p);b(Oe,o,oe)}},[i,O,p,b,o]),L=(0,le.useCallback)((te,oe)=>{if(!O){let Oe=[...re(o),o[o.length-1]+1];F(o,Oe,!0)}},[O,F,o]),X=(0,le.useCallback)((te,oe)=>{!O&&!d&&F(o,"up",te?.altKey)},[O,F,o,d]),xe=(0,le.useCallback)((te,oe)=>{!O&&!G&&F(o,"down",te?.altKey)},[O,F,o,G]),Je=(0,le.useCallback)((te,oe)=>{B("disabled",!O,o)},[O,B,o]),P=(0,le.useCallback)((te,oe)=>{O||S(o)},[O,S,o]),T=(0,le.useMemo)(()=>y[t??""],[t,y]),E=(0,le.useMemo)(()=>qt(T),[T]),de=(0,le.useMemo)(()=>p?null:ve(a,A)?.className??"",[A,a,p]),me=(0,le.useMemo)(()=>h(pe),[h,pe]),Xe=(0,le.useMemo)(()=>(0,Se.clsx)(me,de,w.ruleGroup,s.ruleGroup,{[w.disabled]:O,[w.dndDragging]:_},E),[s.ruleGroup,de,O,me,_,E]),Ee=(0,le.useMemo)(()=>{let te=[];for(let oe=0;oe<pe.rules.length;oe++){let Oe=[...o,oe];te[oe]={path:Oe,disabled:O||c.some(yt=>Ve(Oe,yt))}}return te},[O,o,pe.rules.length,c]),Ye=(0,le.useMemo)(()=>l({path:o,qbId:n}),[l,o,n]);return{...e,addGroup:Pe,addRule:Ne,accessibleDescription:Ye,classNames:We,cloneGroup:L,combinator:A,disabled:O,dragMonitorId:N,dragRef:ae,dropMonitorId:$,dropRef:H,isDragging:_,isOver:ie,onCombinatorChange:Ue,onGroupAdd:b,onIndependentCombinatorChange:je,onNotToggleChange:Ie,outerClassName:Xe,parentDisabled:m,pathsMemo:Ee,previewRef:z,removeGroup:P,ruleGroup:pe,shiftGroupUp:X,shiftGroupDown:xe,toggleLockGroup:Je,validationClassName:E,validationResult:T}};var Zn=require("react"),sn=e=>{let{multiple:t,onChange:o}=e;return(0,Zn.useMemo)(()=>t?n=>o(Array.from(n.target.selectedOptions).map(l=>l.value)):n=>o(n.target.value),[t,o])};var er=require("react"),Ae=e=>(0,er.useCallback)((t,o)=>{t?.preventDefault(),t?.stopPropagation(),e(t,o)},[e]);var tr=require("immer"),xt=require("react");var an=e=>{let{handleOnChange:t,inputType:o,operator:r,value:n,listsAsArrays:l,parseNumbers:s,values:a,type:u,skipHook:i}=e;(0,xt.useEffect)(()=>{!i&&u!=="multiselect"&&!["between","notBetween","in","notIn"].includes(r)&&(Array.isArray(n)||o==="number"&&typeof n=="string"&&n.includes(","))&&t(V(n)[0]??"")},[t,o,r,i,u,n]);let c=(0,xt.useMemo)(()=>V(n),[n]),p=(0,xt.useCallback)((y,f)=>{let h=(0,tr.produce)(c,b=>{b[f]=U(y,{parseNumbers:s}),f===0&&(r==="between"||r==="notBetween")&&(b.length<2||typeof b[1]>"u")&&(b[1]=he(a))});t(l?h:rt(h,","))},[t,l,r,s,c,a]);return{valueAsArray:c,multiValueHandler:p}};var po=require("react");var un=e=>{let{handleOnChange:t,listsAsArrays:o=!1,multiple:r=!1,value:n}=e,l=(0,po.useCallback)(a=>{if(r){let u=V(a);t(o?u:rt(u,","))}else t(a)},[t,o,r]),s=(0,po.useMemo)(()=>r?V(n):n,[r,n]);return{onChange:l,val:s}};var or=require("react"),tt=(0,or.createContext)({});var rr=[],lr=e=>mt.createElement(nr.Provider,{context:dt,store:Zo},e.children),Rl=e=>{let{setup:t,props:o}=e,r=on(o,t),n=r.schema.controls.ruleGroup;return mt.createElement(tt.Provider,{key:r.dndEnabledAttr,value:r.rqbContext},mt.createElement("div",{role:"form",className:r.wrapperClassName,"data-dnd":r.dndEnabledAttr,"data-inlinecombinators":r.inlineCombinatorsAttr},mt.createElement(n,{translations:r.translations,ruleGroup:r.rootGroup,rules:r.rootGroup.rules,...r.combinatorPropObject,not:!!r.rootGroup.not,schema:r.schema,actions:r.actions,id:r.rootGroup.id,path:rr,disabled:r.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:r.queryDisabled,context:r.context})))},sr=e=>{let t=nn(e);return mt.createElement(lr,null,mt.createElement(Rl,{props:e,setup:t}))};var se=Ce(require("react"));var cn=se.memo(e=>{let t=rn(e);return t.cloneRule=Ae(t.cloneRule),t.toggleLockRule=Ae(t.toggleLockRule),t.removeRule=Ae(t.removeRule),t.shiftRuleUp=Ae(t.shiftRuleUp),t.shiftRuleDown=Ae(t.shiftRuleDown),se.createElement("div",{ref:t.dndRef,"data-testid":k.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},se.createElement(ar,{...t}))}),ar=se.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,fieldSelector:r,operatorSelector:n,valueSourceSelector:l,valueEditor:s,cloneRuleAction:a,lockRuleAction:u,removeRuleAction:i}},combinator:c}=e;return se.createElement(se.Fragment,null,e.schema.showShiftActions&&se.createElement(t,{testID:k.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&se.createElement(o,{testID:k.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),c,se.createElement(r,{testID:k.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&se.createElement(se.Fragment,null,se.createElement(n,{testID:k.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&se.createElement(se.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&se.createElement(l,{testID:k.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),se.createElement(s,{testID:k.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&se.createElement(a,{testID:k.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&se.createElement(u,{testID:k.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),se.createElement(i,{testID:k.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))});var j=Ce(require("react")),ir=require("react");var pn=j.memo(e=>{let t=ln(e);return t.addRule=Ae(t.addRule),t.addGroup=Ae(t.addGroup),t.cloneGroup=Ae(t.cloneGroup),t.toggleLockGroup=Ae(t.toggleLockGroup),t.removeGroup=Ae(t.removeGroup),t.shiftGroupUp=Ae(t.shiftGroupUp),t.shiftGroupDown=Ae(t.shiftGroupDown),j.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":k.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},j.createElement("div",{ref:t.dropRef,className:t.classNames.header},j.createElement(ur,{...t})),j.createElement("div",{className:t.classNames.body},j.createElement(cr,{...t})))}),ur=j.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,combinatorSelector:r,notToggle:n,addRuleAction:l,addGroupAction:s,cloneGroupAction:a,lockGroupAction:u,removeGroupAction:i}}}=e;return j.createElement(j.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&j.createElement(t,{key:k.shiftActions,testID:k.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&j.createElement(o,{key:k.dragHandle,testID:k.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&j.createElement(r,{key:k.combinators,testID:k.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&j.createElement(n,{key:k.notToggle,testID:k.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),j.createElement(l,{key:k.addRule,testID:k.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),j.createElement(s,{key:k.addGroup,testID:k.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&j.createElement(a,{key:k.cloneGroup,testID:k.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&j.createElement(u,{key:k.lockGroup,testID:k.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&j.createElement(i,{key:k.removeGroup,testID:k.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),cr=j.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:o,ruleGroup:r,rule:n}}}=e;return j.createElement(j.Fragment,null,e.ruleGroup.rules.map((l,s,{length:a})=>{let u=e.pathsMemo[s],i=u.path,c=u.disabled||typeof l!="string"&&l.disabled,p=Ve([0],i),y=e.path.length===0&&s===a-1,f=typeof l=="string"?[...i,l].join("-"):l.id;return j.createElement(ir.Fragment,{key:f},typeof l=="string"?j.createElement(o,{key:`${k.inlineCombinator}-independent`,options:e.schema.combinators,value:l,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:h=>e.onIndependentCombinatorChange(h,s),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:i,disabled:c,schema:e.schema}):D(l)?j.createElement(r,{key:k.ruleGroup,id:l.id,schema:e.schema,actions:e.actions,path:i,translations:e.translations,ruleGroup:l,rules:l.rules,combinator:J(l)?l.combinator:void 0,not:!!l.not,disabled:c,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context}):j.createElement(n,{key:k.rule,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:e.schema,actions:e.actions,path:i,disabled:c,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context,combinator:s===1&&!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules?j.createElement(o,{key:k.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:i,disabled:e.disabled,schema:e.schema}):s>1?j.createElement("span",null,e.combinator):e.path.length===0?j.createElement("span",null,"Where"):j.createElement("span",null)}))}))});var mo=Ce(require("react")),dn=e=>mo.createElement("div",{"data-testid":e.testID,className:e.className},mo.createElement("button",{disabled:e.disabled||e.shiftUpDisabled,onClick:e.shiftUp,title:e.titles?.shiftUp},e.labels?.shiftUp),mo.createElement("button",{disabled:e.disabled||e.shiftDownDisabled,onClick:e.shiftDown,title:e.titles?.shiftDown},e.labels?.shiftDown));var qe=Ce(require("react"));var mn=e=>{let{operator:t,value:o,handleOnChange:r,title:n,className:l,type:s="text",inputType:a="text",values:u=[],listsAsArrays:i,parseNumbers:c,fieldData:p,disabled:y,separator:f=null,testID:h,selectorComponent:b=e.schema.controls.valueSelector,...S}=e,{valueAsArray:B,multiValueHandler:Q}=an(e);if(t==="null"||t==="notNull")return null;let F=p?.placeholder??"",g=["in","notIn"].includes(t)?"text":a||"text";if((t==="between"||t==="notBetween")&&(s==="select"||s==="text")){let m=["from","to"].map((d,G)=>s==="text"?qe.createElement("input",{key:d,type:g,placeholder:F,value:B[G]??"",className:w.valueListItem,disabled:y,onChange:x=>Q(x.target.value,G)}):qe.createElement(b,{...S,schema:e.schema,key:d,className:w.valueListItem,handleOnChange:x=>Q(x,G),disabled:y,value:B[G]??he(u),options:u,listsAsArrays:i}));return qe.createElement("span",{"data-testid":h,className:l,title:n},m[0],f,m[1])}switch(s){case"select":case"multiselect":return qe.createElement(b,{...S,schema:e.schema,testID:h,className:l,title:n,handleOnChange:r,disabled:y,value:o,options:u,multiple:s==="multiselect",listsAsArrays:i});case"textarea":return qe.createElement("textarea",{"data-testid":h,placeholder:F,value:o,title:n,className:l,disabled:y,onChange:m=>r(m.target.value)});case"switch":case"checkbox":return qe.createElement("input",{"data-testid":h,type:"checkbox",className:l,title:n,onChange:m=>r(m.target.checked),checked:!!o,disabled:y});case"radio":return qe.createElement("span",{"data-testid":h,className:l,title:n},u.map(m=>qe.createElement("label",{key:m.name},qe.createElement("input",{type:"radio",value:m.name,disabled:y,checked:o===m.name,onChange:d=>r(d.target.value)}),m.label)))}return qe.createElement("input",{"data-testid":h,type:g,placeholder:F,value:o,title:n,className:l,disabled:y,onChange:m=>r(U(m.target.value,{parseNumbers:c}))})};var pr=Ce(require("react"));var ft=e=>{let{onChange:t,val:o}=un(e),r=sn({multiple:e.multiple,onChange:t});return pr.createElement("select",{"data-testid":e.testID,className:e.className,value:o,title:e.title,disabled:e.disabled,multiple:!!e.multiple,onChange:r},zo(e.options))};var Yo={actionElement:ke,addGroupAction:ke,addRuleAction:ke,cloneGroupAction:ke,cloneRuleAction:ke,combinatorSelector:ft,dragHandle:Ro,fieldSelector:ft,inlineCombinator:Oo,lockGroupAction:ke,lockRuleAction:ke,notToggle:vo,operatorSelector:ft,removeGroupAction:ke,removeRuleAction:ke,rule:cn,ruleGroup:pn,shiftActions:dn,valueEditor:mn,valueSelector:ft,valueSourceSelector:ft};0&&(module.exports={ActionElement,DragHandle,InlineCombinator,LogType,NotToggle,QueryBuilder,QueryBuilderContext,QueryBuilderStateContext,QueryBuilderStateProvider,Rule,RuleComponents,RuleGroup,RuleGroupBodyComponents,RuleGroupHeaderComponents,ShiftActions,TestID,ValueEditor,ValueSelector,add,convertFromIC,convertQuery,convertToIC,defaultCELValueProcessor,defaultCombinators,defaultCombinatorsExtended,defaultControlClassnames,defaultControlElements,defaultJoinChar,defaultMongoDBValueProcessor,defaultOperatorNegationMap,defaultOperators,defaultPlaceholderFieldGroupLabel,defaultPlaceholderFieldLabel,defaultPlaceholderFieldName,defaultPlaceholderOperatorGroupLabel,defaultPlaceholderOperatorLabel,defaultPlaceholderOperatorName,defaultRuleProcessorCEL,defaultRuleProcessorElasticSearch,defaultRuleProcessorJSONata,defaultRuleProcessorJsonLogic,defaultRuleProcessorMongoDB,defaultRuleProcessorParameterized,defaultRuleProcessorSQL,defaultRuleProcessorSpEL,defaultSpELValueProcessor,defaultTranslations,defaultValidator,defaultValueProcessor,defaultValueProcessorByRule,defaultValueProcessorCELByRule,defaultValueProcessorMongoDBByRule,defaultValueProcessorSpELByRule,filterFieldsByComparator,findPath,formatQuery,generateAccessibleDescription,generateID,getCommonAncestorPath,getCompatContextProvider,getFirstOption,getOption,getParentPath,getQuerySelectorById,getValidationClassNames,getValueSourcesUtil,groupInvalidReasons,isAncestor,isFlexibleOptionGroupArray,isFullOptionGroupArray,isOptionGroupArray,isPojo,isRuleGroup,isRuleGroupType,isRuleGroupTypeIC,isRuleOrGroupValid,isValidationResult,joinWith,jsonLogicAdditionalOperators,mergeClassnames,mergeTranslations,messages,move,nullFreeArray,numericRegex,objectEntries,objectKeys,parseNumber,pathIsDisabled,pathsAreEqual,prepareRule,prepareRuleGroup,prepareRuleOrGroup,queryBuilderStore,regenerateID,regenerateIDs,remove,rootPath,splitBy,standardClassnames,toArray,toFlatOptionArray,toFullOption,toFullOptionList,toFullOptionMap,toOptions,transformQuery,trimIfString,uniqByIdentifier,uniqByName,uniqOptGroups,uniqOptList,update,useControlledOrUncontrolled,useDeprecatedProps,useMergedContext,usePreferAnyProp,usePreferProp,usePrevious,useQueryBuilderSchema,useQueryBuilderSelector,useQueryBuilderSetup,useReactDndWarning,useRule,useRuleGroup,useSelectElementChangeHandler,useStopEventPropagation,useValueEditor,useValueSelector});
//# sourceMappingURL=react-querybuilder.cjs.production.js.map