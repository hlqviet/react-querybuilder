import*as Po from"react";var Le=e=>Po.createElement("button",{type:"button","data-testid":e.testID,disabled:e.disabled&&!e.disabledTranslation,className:e.className,title:e.disabledTranslation&&e.disabled?e.disabledTranslation.title:e.title,onClick:t=>e.handleOnClick(t)},e.disabledTranslation&&e.disabled?e.disabledTranslation.label:e.label);import*as Eo from"react";import{forwardRef as Hn}from"react";var Fo=Hn((e,t)=>Eo.createElement("span",{"data-testid":e.testID,ref:t,className:e.className,title:e.title},e.label));import*as co from"react";var Do="~",Pt="------",Et=Do,_n=Pt,Jn=Pt,Ft=Do,zn=Pt,Kn=Pt,Dt=",",wo={fields:{title:"Fields",placeholderName:Et,placeholderLabel:_n,placeholderGroupLabel:Jn},operators:{title:"Operators",placeholderName:Ft,placeholderLabel:zn,placeholderGroupLabel:Kn},value:{title:"Value"},removeRule:{label:"\u2A2F",title:"Remove rule"},removeGroup:{label:"\u2A2F",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"\u29C9",title:"Clone rule"},cloneRuleGroup:{label:"\u29C9",title:"Clone group"},shiftActionUp:{label:"\u02C4",title:"Shift up"},shiftActionDown:{label:"\u02C5",title:"Shift down"},dragHandle:{label:"\u205E\u205E",title:"Drag handle"},lockRule:{label:"\u{1F513}",title:"Lock rule"},lockGroup:{label:"\u{1F513}",title:"Lock group"},lockRuleDisabled:{label:"\u{1F512}",title:"Unlock rule"},lockGroupDisabled:{label:"\u{1F512}",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},Bo=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],rl={"=":"!=","!=":"=","<":">=","<=":">",">":"<=",">=":"<",beginsWith:"doesNotBeginWith",doesNotBeginWith:"beginsWith",endsWith:"doesNotEndWith",doesNotEndWith:"endsWith",contains:"doesNotContain",doesNotContain:"contains",between:"notBetween",notBetween:"between",in:"notIn",notIn:"in",notNull:"null",null:"notNull"},He=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}],ll=[...He,{name:"xor",value:"xor",label:"XOR"}],w={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dndCopy:"dndCopy",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item",branches:"queryBuilder-branches"},Io={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},wt={empty:"empty",invalidCombinator:"invalid combinator",invalidIndependentCombinators:"invalid independent combinators"},k={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},ge={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",queryUpdate:"query updated",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"};var ko=e=>{let{component:t,...o}=e;return co.createElement("div",{className:w.betweenRules,"data-testid":k.inlineCombinator},co.createElement(t,{...o,testID:k.combinators}))};import*as po from"react";var Qo=e=>po.createElement("label",{"data-testid":e.testID,className:e.className,title:e.title},po.createElement("input",{type:"checkbox",onChange:t=>e.handleOnChange(t.target.checked),checked:!!e.checked,disabled:e.disabled}),e.label);import*as st from"react";import{Provider as Hr}from"react-redux";var cl={errorInvalidIndependentCombinatorsProp:"QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorUnnecessaryIndependentCombinatorsProp:"QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",errorDeprecatedRuleGroupProps:"A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",errorDeprecatedRuleProps:"A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",errorBothQueryDefaultQuery:"QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",errorUncontrolledToControlled:"QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorControlledToUncontrolled:"QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",errorEnabledDndWithoutReactDnD:"QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd."};import{useRef as Xn}from"react";var Lo=e=>{let t=Xn({value:e,prev:null}),o=t.current.value;return e!==o&&(t.current={value:e,prev:o}),t.current.prev};var Vo=e=>{let{defaultQuery:t,queryProp:o}=e,r=Lo(!!o)};function mo(e,t,o){}import{forwardRef as Rr,useContext as gr,useMemo as Oo}from"react";var Yn=(e,t=Dt)=>typeof e=="string"?e.split(`\\${t}`).map(o=>o.split(t)).reduce((o,r,n)=>n===0?r:[...o.slice(0,o.length-1),`${o[o.length-1]}${t}${r[0]}`,...r.slice(1)],[]):[],ut=(e,t=Dt)=>e.map(o=>`${o??""}`.replaceAll(t,`\\${t}`)).join(t),W=e=>typeof e=="string"?e.trim():e,M=e=>Array.isArray(e)?e.map(W):typeof e=="string"?Yn(e,Dt).filter(t=>!/^\s*$/.test(t)).map(t=>t.trim()):typeof e=="number"?[e]:[],Al=e=>e.every(t=>t===!1||(t??!1)!==!1);import{numericRegex as Zn}from"numeric-quantity";var Mo=new RegExp(Zn.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),re=e=>e===null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype;var D=e=>re(e)&&"rules"in e&&Array.isArray(e.rules),J=e=>D(e)&&typeof e.combinator=="string",Ye=e=>D(e)&&typeof e.combinator>"u";var qo=e=>D(e)?Wo(e):e,Wo=e=>{let t=[],o=n=>t.push(qo(n)),r=0;for(let n=0;n<e.rules.length;n+=2)if(e.rules.length===1)o(e.rules[0]);else if(e.rules[n+1]==="and"){r=n;let l=1;for(;e.rules[r+l]==="and";)n+=2,l+=2;t.push({rules:e.rules.slice(r,n+1).map(qo)}),n-=2}else e.rules[n+1]==="or"&&(n===0||n===e.rules.length-3?((n===0||e.rules[n-1]==="or")&&o(e.rules[n]),o(e.rules[n+1]),n===e.rules.length-3&&o(e.rules[n+2])):(e.rules[n-1]==="and"||o(e.rules[n]),o(e.rules[n+1])));return t.length===1&&typeof t[0]=="object"&&D(t[0])?{...e,...t[0]}:{...e,rules:t}},ct=e=>{if(J(e))return e;let t=Wo(e),o=t.rules.map(l=>typeof l=="string"||!D(l)?l:ct(l)),r=o.length<2?"and":o[1],n=o.filter(l=>typeof l!="string");return{...t,combinator:r,rules:n}},Uo=e=>{if(Ye(e))return e;let{combinator:t,...o}=e,r=[],{length:n}=e.rules;return e.rules.forEach((l,s)=>{D(l)?r.push(Uo(l)):r.push(l),t&&s<n-1&&r.push(t)}),{...o,rules:r}};function Nl(e){return Ye(e)?ct(e):Uo(e)}var Dl=e=>{let t={},o=n=>{},r=n=>{let l=[];if(n.rules.length===0)l.push(wt.empty);else if(!J(n)){let s=!1;for(let a=0;a<n.rules.length&&!s;a++)(a%2===0&&typeof n.rules[a]=="string"||a%2===1&&typeof n.rules[a]!="string"||a%2===1&&typeof n.rules[a]=="string"&&!He.map(u=>u.name).includes(n.rules[a]))&&(s=!0);s&&l.push(wt.invalidIndependentCombinators)}J(n)&&!He.map(s=>s.name).includes(n.combinator)&&n.rules.length>1&&l.push(wt.invalidCombinator),n.id&&(l.length?t[n.id]={valid:!1,reasons:l}:t[n.id]=!0),n.rules.forEach(s=>{typeof s=="string"||(D(s)?r(s):o(s))})};return r(e),t};import{produce as _o}from"immer";var jo=e=>re(e)&&"name"in e&&typeof e.name=="string",Ho=e=>re(e)&&"value"in e&&typeof e.value=="string";function fe(e,t){return _o(r=>{let n={},l=!!t;if(jo(r)&&!Ho(r)?(n.value=r.name,l=!0):!jo(r)&&Ho(r)&&(n.name=r.value,l=!0),l)return Object.assign({},t,r,n)})(e)}function Ve(e,t){return Array.isArray(e)?_o(r=>{if(Ne(r))for(let n of r)n.options.forEach((l,s)=>n.options[s]=fe(l,t));else r.forEach((n,l)=>r[l]=fe(n,t))})(e):[]}function fo(e,t){return Object.fromEntries(Object.entries(e).map(([o,r])=>[o,fe(r,t)]))}var Ml=e=>et(e),et=e=>{let t=new Set,o=[];return e.forEach(r=>{t.has(r.value??r.name)||(t.add(r.value??r.name),o.push(r))}),e.length===o.length?e:o},Bt=e=>{let t=new Set,o=new Set,r=[];return e.forEach(n=>{if(!t.has(n.label)){t.add(n.label);let l=[];n.options.forEach(s=>{o.has(s.value??s.name)||(o.add(s.value??s.name),l.push(fe(s)))}),r.push({...n,options:l})}}),r},Jo=e=>Ne(e)?Bt(e):et(e.map(t=>fe(t)));var It=e=>Array.isArray(e)&&e.length>0&&re(e[0])&&"options"in e[0],Ne=e=>Array.isArray(e)&&e.length>0&&re(e[0])&&"options"in e[0]&&re(e[0].options[0])&&("name"in e[0].options[0]||"value"in e[0].options[0]),jl=e=>Array.isArray(e)&&e.length>0&&re(e[0])&&"options"in e[0]&&re(e[0].options[0])&&"name"in e[0].options[0]&&re(e[0].options[0])&&"value"in e[0].options[0],Ae=(e,t)=>(It(e)?e.flatMap(o=>o.options):e).find(o=>o.name===t),de=e=>!Array.isArray(e)||e.length===0?null:Ne(e)?e[0].options[0].value??e[0].options[0].name:e[0].value??e[0].name,zo=e=>et(It(e)?e.flatMap(t=>t.options):e);var Ko=(e,t,o)=>{let r=fe(e),n=fe(o);return r.value===n.value?!1:typeof r.comparator=="string"?r[r.comparator]===n[r.comparator]:r.comparator?.(n,t)??!1},kt=(e,t,o)=>{if(!e.comparator){let r=n=>(n.value??n.name)!==(e.value??e.name);return Ne(t)?t.map(n=>({...n,options:n.options.filter(r)})):t.filter(r)}return Ne(t)?t.map(r=>({...r,options:r.options.filter(n=>Ko(e,o,n))})).filter(r=>r.options.length>0):t.filter(r=>Ko(e,o,r))};import{numericQuantity as er}from"numeric-quantity";var H=(e,t={})=>{if(!t.parseNumbers||typeof e=="bigint"||typeof e=="number")return e;if(t.parseNumbers==="native")return parseFloat(e);let o=er(e,{allowTrailingInvalid:t.parseNumbers==="enhanced",romanNumerals:!0,round:!1});return isNaN(o)?e:o};var Qt=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},yo={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},ho={and:"&&",or:"||"},tr={startsWith:(e,t)=>typeof e=="string"&&e.startsWith(t),endsWith:(e,t)=>typeof e=="string"&&e.endsWith(t)},bo=e=>({...e,rules:e.rules.map(t=>{if(typeof t=="string")return t;if(D(t))return bo(t);let{value:o}=t;return typeof o=="string"&&(o=H(o,{parseNumbers:!0})),{...t,value:o}})}),Pe=e=>typeof e=="string"&&e.length>0||typeof e=="number"&&!isNaN(e)||typeof e!="string"&&typeof e!="number",I=(e,t)=>t&&(typeof e=="number"||typeof e=="bigint"||typeof e=="string"&&Mo.test(e)),Xo=e=>e.length>=3,Ze=(e=["",""])=>Array.isArray(e)?e:typeof e=="string"?[e,e]:e??["",""],_e=e=>e===null||typeof e>"u"||e==="";var Lt=e=>/^(does)?not/i.test(e),tt=(e,t)=>typeof e!="string"||!t?e:e.replaceAll('"','\\"'),pt=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l}={})=>{let s=r==="field",a=t.replace(/^=$/,"=="),u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||u?W(o):`"${tt(o,n)}"`}`;case"contains":case"doesNotContain":return`${Lt(a)?"!":""}${e}.contains(${s?W(o):`"${tt(o,n)}"`})`;case"beginsWith":case"doesNotBeginWith":return`${Lt(a)?"!":""}${e}.startsWith(${s?W(o):`"${tt(o,n)}"`})`;case"endsWith":case"doesNotEndWith":return`${Lt(a)?"!":""}${e}.endsWith(${s?W(o):`"${tt(o,n)}"`})`;case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let i=Lt(a),c=M(o);return`${i?"!(":""}${e} in [${c.map(p=>s||I(p,l)?`${W(p)}`:`"${tt(p,n)}"`).join(", ")}]${i?")":""}`}case"between":case"notBetween":{let i=M(o);if(i.length>=2&&!_e(i[0])&&!_e(i[1])){let[c,p]=i,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`"${tt(c,n)}"`:y,b=isNaN(f)?s?`${p}`:`"${tt(p,n)}"`:f;if(h===y&&b===f&&f<y){let S=f;b=y,h=S}return t==="between"?`(${e} >= ${h} && ${e} <= ${b})`:`(${e} < ${h} || ${e} > ${b})`}else return""}}return""};var we=e=>typeof e!="string"?e:e.replaceAll("\\","\\\\").replaceAll('"','\\"'),dt=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{let l=r==="field",s=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,n);if(t==="="&&!l)return`{"${e}":${s?W(o):`"${we(o)}"`}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let a=yo[t];return l?`{"$expr":{"${a}":["$${e}","$${o}"]}}`:`{"${e}":{"${a}":${s?W(o):`"${we(o)}"`}}}`}case"contains":return l?`{"$where":"this.${e}.includes(this.${o})"}`:`{"${e}":{"$regex":"${we(o)}"}}`;case"beginsWith":return l?`{"$where":"this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$regex":"^${we(o)}"}}`;case"endsWith":return l?`{"$where":"this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$regex":"${we(o)}$"}}`;case"doesNotContain":return l?`{"$where":"!this.${e}.includes(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${we(o)}"}}}`;case"doesNotBeginWith":return l?`{"$where":"!this.${e}.startsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"^${we(o)}"}}}`;case"doesNotEndWith":return l?`{"$where":"!this.${e}.endsWith(this.${o})"}`:`{"${e}":{"$not":{"$regex":"${we(o)}$"}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let a=M(o);return l?`{"$where":"${t==="notIn"?"!":""}[${a.map(u=>`this.${u}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${yo[t]}":[${a.map(u=>I(u,n)?`${W(u)}`:`"${we(u)}"`).join(",")}]}}`}case"between":case"notBetween":{let a=M(o);if(a.length>=2&&Pe(a[0])&&Pe(a[1])){let[u,i]=a,c=I(u,!0)?H(u,{parseNumbers:!0}):NaN,p=I(i,!0)?H(i,{parseNumbers:!0}):NaN,y=l||!isNaN(c)?`${u}`:`"${we(u)}"`,f=l||!isNaN(p)?`${i}`:`"${we(i)}"`;return t==="between"?l?`{"$and":[{"$expr":{"$gte":["$${e}","$${y}"]}},{"$expr":{"$lte":["$${e}","$${f}"]}}]}`:`{"${e}":{"$gte":${y},"$lte":${f}}}`:l?`{"$or":[{"$expr":{"$lt":["$${e}","$${y}"]}},{"$expr":{"$gt":["$${e}","$${f}"]}}]}`:`{"$or":[{"${e}":{"$lt":${y}}},{"${e}":{"$gt":${f}}}]}`}else return""}}return""};var Vt=e=>/^(does)?not/i.test(e),Ro=(e,t)=>t?`!(${e})`:`${e}`,ot=(e,t)=>typeof e!="string"||!t?e:e.replaceAll("'","\\'"),mt=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l}={})=>{let s=r==="field",a=t.replace(/^=$/,"=="),u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l);switch(a){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${a} ${s||u?W(o):`'${ot(o,n)}'`}`;case"contains":case"doesNotContain":return Ro(`${e} matches ${s||u?W(o):`'${ot(o,n)}'`}`,Vt(a));case"beginsWith":case"doesNotBeginWith":{let i=s?`'^'.concat(${W(o)})`:`'${typeof o=="string"&&!o.startsWith("^")||u?"^":""}${ot(o,n)}'`;return Ro(`${e} matches ${i}`,Vt(a))}case"endsWith":case"doesNotEndWith":{let i=s?`${W(o)}.concat('$')`:`'${ot(o,n)}${typeof o=="string"&&!o.endsWith("$")||u?"$":""}'`;return Ro(`${e} matches ${i}`,Vt(a))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let i=Vt(a)?"!":"",c=M(o);return c.length>0?`${i}(${c.map(p=>`${e} == ${s||I(p,l)?`${W(p)}`:`'${ot(p,n)}'`}`).join(" or ")})`:""}case"between":case"notBetween":{let i=M(o);if(i.length>=2&&!_e(i[0])&&!_e(i[1])){let[c,p]=i,y=I(c,!0)?H(c,{parseNumbers:!0}):NaN,f=I(p,!0)?H(p,{parseNumbers:!0}):NaN,h=isNaN(y)?s?`${c}`:`'${ot(c,n)}'`:y,b=isNaN(f)?s?`${p}`:`'${ot(p,n)}'`:f;if(h===y&&b===f&&f<y){let S=f;b=y,h=S}return t==="between"?`(${e} >= ${h} and ${e} <= ${b})`:`(${e} < ${h} or ${e} > ${b})`}else return""}}return""};var or=(e,t,o)=>o&&typeof e=="string"?e.replaceAll(`${t}`,`${t}${t}`):e,Je=({operator:e,value:t,valueSource:o},{escapeQuotes:r,parseNumbers:n,quoteFieldNamesWith:l,quoteValuesWith:s}={})=>{let a=o==="field",[u,i]=Ze(l),c=e.toLowerCase(),p=s||"'",y=b=>or(b,p,r),f=b=>`${p}${y(b)}${p}`,h=b=>`${u}${b}${i}`;switch(c){case"null":case"notnull":return"";case"in":case"notin":{let b=M(t);return b.length>0?`(${b.map(S=>a?h(S):I(S,n)?`${W(S)}`:`${f(S)}`).join(", ")})`:""}case"between":case"notbetween":{let b=M(t);if(b.length>=2&&Pe(b[0])&&Pe(b[1])){let[S,B]=b;return a?`${h(S)} and ${h(B)}`:I(S,n)&&I(B,n)?`${W(S)} and ${W(B)}`:`${f(S)} and ${f(B)}`}return""}case"contains":case"doesnotcontain":return a?`${p}%${p} || ${h(t)} || ${p}%${p}`:`${p}%${y(t)}%${p}`;case"beginswith":case"doesnotbeginwith":return a?`${h(t)} || ${p}%${p}`:`${p}${y(t)}%${p}`;case"endswith":case"doesnotendwith":return a?`${p}%${p} || ${h(t)}`:`${p}%${y(t)}${p}`}return typeof t=="boolean"?t?"TRUE":"FALSE":a?h(t):I(t,n)?`${W(t)}`:`${f(t)}`};var nr={"<":"lt","<=":"lte",">":"gt",">=":"gte"},Mt=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,go=e=>e?.replace(/('|\\)/g,"\\$1"),rr={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},lr=(e,t,o)=>{let r=`doc['${e}'].${rr[t]??t}(doc['${o}'])`;return t.startsWith("d")?`!${r}`:r},Ot=(e,t)=>typeof e=="boolean"?e:I(e,t)?H(e,{parseNumbers:t}):e,qt=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{if(r==="field"){if(M(o).some(s=>typeof s!="string"))return!1;let l=go(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let s=t==="="?"==":t,a=go(o);return a?{bool:{filter:{script:{script:`doc['${l}'] ${s} doc['${a}']`}}}}:!1}case"in":case"notIn":{let s=M(o);if(s.length>0){let a=s.map(u=>({bool:{filter:{script:{script:`doc['${l}'] == doc['${u}']`}}}}));return{bool:t==="in"?{should:a}:{must_not:a}}}return!1}case"between":case"notBetween":{let s=M(o);if(s.length>=2&&s[0]&&s[1]){let a=`doc['${l}'] >= doc['${s[0]}'] && doc['${l}'] <= doc['${s[1]}']`;return{bool:{filter:{script:{script:t==="notBetween"?`!(${a})`:a}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let s=go(o);return s?{bool:{filter:{script:{script:lr(l,t,s)}}}}:!1}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[nr[t]]:Ot(o,n)}}};case"=":return{term:{[e]:Ot(o,n)}};case"!=":return{bool:{must_not:{term:{[e]:Ot(o,n)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let l=M(o).map(s=>Ot(s,n));if(l.length>0){let s=l.map(a=>({term:{[e]:Ot(a,n)}}));return{bool:t==="in"?{should:s}:{must_not:s}}}return!1}case"between":case"notBetween":{let l=M(o);if(l.length>=2&&Pe(l[0])&&Pe(l[1])){let[s,a]=l;if(I(s,!0)&&I(a,!0)){let u=H(s,{parseNumbers:!0}),i=H(a,{parseNumbers:!0});if(i<u){let c=i;a=u,s=c}else s=u,a=i}return Mt(t,{range:{[e]:{gte:s,lte:a}}})}return!1}case"contains":case"doesNotContain":return Mt(t,{regexp:{[e]:{value:o}}});case"beginsWith":case"doesNotBeginWith":return Mt(t,{regexp:{[e]:{value:`^${o}`}}});case"endsWith":case"doesNotEndWith":return Mt(t,{regexp:{[e]:{value:`${o}$`}}})}return!1};var Wt=e=>/^(does)?not/i.test(e),Ct=(e,t)=>`"${typeof e!="string"||!t?e:e.replaceAll('"','\\"')}"`,vt=(e,t)=>t?`$not(${e})`:`${e}`,Yo=e=>`${e}`.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d"),Ut=({field:e,operator:t,value:o,valueSource:r},{escapeQuotes:n,parseNumbers:l=!0,quoteFieldNamesWith:s=["",""]}={})=>{let a=r==="field",u=typeof o=="number"||typeof o=="boolean"||typeof o=="bigint"||I(o,l),[i,c]=Ze(s),p=y=>`${i}${y}${c}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return`${p(e)} ${t} ${a?p(W(o)):u?W(o):Ct(o,n)}`;case"contains":case"doesNotContain":return vt(`$contains(${p(e)}, ${a?p(W(o)):Ct(o,n)})`,Wt(t));case"beginsWith":case"doesNotBeginWith":return vt(a?`$substring(${p(e)}, 0, $length(${p(W(o))})) = ${p(W(o))}`:`$contains(${p(e)}, /^${Yo(o)}/)`,Wt(t));case"endsWith":case"doesNotEndWith":return vt(a?`$substring(${p(e)}, $length(${p(e)}) - $length(${p(W(o))})) = ${p(W(o))}`:`$contains(${p(e)}, /${Yo(o)}$/)`,Wt(t));case"null":return`${p(e)} = null`;case"notNull":return`${p(e)} != null`;case"in":case"notIn":{let y=M(o);return vt(`${p(e)} in [${y.map(f=>a?`${p(W(f))}`:I(f,l)?`${W(f)}`:Ct(f,n)).join(", ")}]`,Wt(t))}case"between":case"notBetween":{let y=M(o);if(y.length>=2&&!_e(y[0])&&!_e(y[1])){let[f,h]=y,b=I(f,!0)?H(f,{parseNumbers:!0}):NaN,S=I(h,!0)?H(h,{parseNumbers:!0}):NaN,B=isNaN(b)?a?`${f}`:f:b,Q=isNaN(S)?a?`${h}`:h:S;if(B===b&&Q===S&&S<b){let m=S;Q=b,B=m}let F=I(f,l)&&I(h,l),g=`${p(e)} >= ${a?p(f):F?B:Ct(B,n)} and ${p(e)} <= ${a?p(h):F?Q:Ct(Q,n)}`;return t==="between"?`(${g})`:vt(g,!0)}else return""}}return""};var sr=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),$t=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,jt=({field:e,operator:t,value:o,valueSource:r},{parseNumbers:n}={})=>{let l=r==="field",s={var:e},a=u=>l?{var:`${u}`}:I(u,n)?H(u,{parseNumbers:n}):u;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[sr(t)]:[s,a(o)]};case"null":case"notNull":return{[`${t==="notNull"?"!":"="}=`]:[s,null]};case"in":case"notIn":{let u=M(o).map(a);return $t(t,{in:[s,u]})}case"between":case"notBetween":{let u=M(o);if(u.length>=2&&Pe(u[0])&&Pe(u[1])){let[i,c]=u;if(!l&&I(i,!0)&&I(c,!0)){let y=H(i,{parseNumbers:!0}),f=H(c,{parseNumbers:!0});if(f<y){let h=f;c=y,i=h}else i=y,c=f}else l&&(i={var:i},c={var:c});return $t(t,{"<=":[i,s,c]})}return!1}case"contains":case"doesNotContain":{let u={in:[a(o),s]};return $t(t,u)}case"beginsWith":case"doesNotBeginWith":{let u={startsWith:[s,a(o)]};return $t(t,u)}case"endsWith":case"doesNotEndWith":{let u={endsWith:[s,a(o)]};return $t(t,u)}}return!1};var Tt=(e,t,o)=>{let{fieldData:r,format:n,getNextNamedParam:l,parseNumbers:s,paramPrefix:a,paramsKeepPrefix:u,numberedParams:i,quoteFieldNamesWith:c=["",""],valueProcessor:p=Je}=t??{},{processedParams:y=[]}=o??{},f=n==="parameterized",h=[],b={},S=d=>f?{sql:d,params:h}:{sql:d,params:b},B=p(e,{parseNumbers:s,quoteFieldNamesWith:c,fieldData:r,format:n}),Q=Qt(e.operator),F=Q.toLowerCase();if((F==="in"||F==="not in"||F==="between"||F==="not between")&&!B)return S("");if(F==="is null"||F==="is not null")return S(`${c[0]}${e.field}${c[1]} ${Q}`);if(e.valueSource==="field")return S(`${c[0]}${e.field}${c[1]} ${Q} ${B}`.trim());if(F==="in"||F==="not in"){let d=M(e.value);if(f)return d.forEach(x=>h.push(I(x,s)?H(x,{parseNumbers:s}):x)),S(`${c[0]}${e.field}${c[1]} ${Q} (${d.map((x,v)=>i?`${a}${y.length+1+d.length-(d.length-v)}`:"?").join(", ")})`);let G=[];return d.forEach(x=>{let v=l(e.field);G.push(`${a}${v}`),b[`${u?a:""}${v}`]=I(x,s)?H(x,{parseNumbers:s}):x}),S(`${c[0]}${e.field}${c[1]} ${Q} (${G.join(", ")})`)}else if(F==="between"||F==="not between"){let d=M(e.value),[G,x]=d.slice(0,2).map(N=>I(N,s)?H(N,{parseNumbers:s}):N);if(f)return h.push(G),h.push(x),S(`${c[0]}${e.field}${c[1]} ${Q} ${i?`${a}${y.length+1}`:"?"} and ${i?`${a}${y.length+2}`:"?"}`);let v=l(e.field),R=l(e.field);return b[`${u?a:""}${v}`]=G,b[`${u?a:""}${R}`]=x,S(`${c[0]}${e.field}${c[1]} ${Q} ${a}${v} and ${a}${R}`)}let g=e.value;typeof e.value=="string"&&(I(e.value,s)?g=H(e.value,{parseNumbers:s}):g=/^'.*'$/g.test(B)?B.replace(/(^'|'$)/g,""):B);let m="";return f?h.push(g):(m=l(e.field),b[`${u?a:""}${m}`]=g),S(`${c[0]}${e.field}${c[1]} ${Q} ${f?i?`${a}${y.length+1}`:"?":`${a}${m}`}`.trim())};var xo=(e,t)=>{let{parseNumbers:o,escapeQuotes:r,quoteFieldNamesWith:n=["",""],quoteValuesWith:l="'",valueProcessor:s=Je}=t??{},a=s(e,{parseNumbers:o,escapeQuotes:r,quoteFieldNamesWith:n,quoteValuesWith:l}),u=Qt(e.operator),i=u.toLowerCase();if((i==="in"||i==="not in"||i==="between"||i==="not between")&&!a)return"";let[c,p]=Ze(n);return`${c}${e.field}${p} ${u} ${a}`.trim()};var Zo=e=>re(e)&&typeof e.valid=="boolean",pe=(e,t,o)=>{if(typeof t=="boolean")return t;if(Zo(t))return t.valid;if(typeof o=="function"&&!D(e)){let r=o(e);if(typeof r=="boolean")return r;if(Zo(r))return r.valid}return!0};function na(e,t={}){let o="json",r=Je,n=null,l=["",""],s=()=>!0,a=[],u={},i="",c=":",p=!1,y=!1,f=!1,h=Et,b=Ft,S="'";if(typeof t=="string")o=t.toLowerCase(),o==="mongodb"?n=dt:o==="parameterized"?n=Tt:o==="parameterized_named"?n=Tt:o==="cel"?n=pt:o==="spel"?n=mt:o==="jsonlogic"?n=jt:o==="elasticsearch"?n=qt:o==="jsonata"&&(n=Ut);else{o=(t.format??"json").toLowerCase();let{valueProcessor:g=null,ruleProcessor:m=null}=t;typeof m=="function"&&(n=m),r=typeof g=="function"?(d,G)=>Xo(g)?g(d.field,d.operator,d.value,d.valueSource):g(d,G):o==="mongodb"?n??dt:o==="cel"?n??pt:o==="spel"?n??mt:o==="jsonlogic"?n??jt:o==="elasticsearch"?n??qt:o==="jsonata"?n??Ut:Je,l=Ze(t.quoteFieldNamesWith),s=t.validator??(()=>!0),a=Ve(t.fields??[]),i=t.fallbackExpression??"",c=t.paramPrefix??":",p=!!t.paramsKeepPrefix,y=!!t.numberedParams,f=!!t.parseNumbers,h=t.placeholderFieldName??Et,b=t.placeholderOperatorName??Ft,S=t.quoteValuesWith??"'"}if(i||(i=o==="mongodb"?'"$and":[{"$expr":true}]':o==="cel"||o==="spel"?"1 == 1":"(1 = 1)"),o==="json"||o==="json_without_ids"){let g=f?bo(e):e;return o==="json"?JSON.stringify(g,null,2):JSON.stringify(g,(m,d)=>m==="id"||m==="path"?void 0:d)}if(typeof s=="function"){let g=s(e);if(typeof g=="boolean"){if(g===!1)return o==="parameterized"?{sql:i,params:[]}:o==="parameterized_named"?{sql:i,params:{}}:o==="mongodb"?`{${i}}`:o==="jsonlogic"?!1:o==="elasticsearch"?{}:i}else u=g}let B={},Q=zo(a);Q.forEach(g=>{typeof g.validator=="function"&&(B[g.value??g.name]=g.validator)});let F=g=>{let m,d;if(g.id&&(m=u[g.id]),Q.length){let G=Q.filter(x=>x.name===g.field);if(G.length){let x=G[0];typeof x.validator=="function"&&(d=x.validator)}}return[m,d]};if(o==="sql"){let g=(m,d)=>{if(!pe(m,u[m.id??""]))return d?i:"";let G=m.rules.map(x=>{if(typeof x=="string")return x;if(D(x))return g(x,m.rules.length===1);let[v,R]=F(x);if(!pe(x,v,R)||x.field===h||x.operator===b)return"";let N=(x.valueSource??"value")==="value",$=Ae(a,x.field);return typeof n=="function"?n(x,{parseNumbers:f,escapeQuotes:N,quoteFieldNamesWith:l,fieldData:$,format:o,quoteValuesWith:S}):xo(x,{parseNumbers:f,escapeQuotes:N,valueProcessor:r,quoteFieldNamesWith:l,fieldData:$,format:o,quoteValuesWith:S})});return G.length===0?i:`${m.not?"NOT ":""}(${G.filter(Boolean).join(J(m)?` ${m.combinator} `:" ")})`};return g(e,!0)}if(o==="parameterized"||o==="parameterized_named"){let g=o==="parameterized",m=[],d={},G=new Map,x=N=>{G.has(N)||G.set(N,new Set);let $=`${N}_${G.get(N).size+1}`;return G.get(N).add($),$},v=N=>{let[$,z]=F(N);if(!pe(N,$,z)||N.field===h||N.operator===b)return"";let oe=Ae(a,N.field),j=Object.fromEntries(Array.from(G.entries()).map(([A,ae])=>[A,Array.from(ae)])),_=(typeof n=="function"?n:Tt)(N,{getNextNamedParam:x,fieldParamNames:j,parseNumbers:f,quoteFieldNamesWith:l,fieldData:oe,format:o,paramPrefix:c,paramsKeepPrefix:p,numberedParams:y,fallbackExpression:i,valueProcessor:r,fields:a,placeholderFieldName:h,placeholderOperatorName:b,validator:s},{processedParams:m});if(!re(_))return"";let{sql:ne,params:O}=_;return typeof ne!="string"||!ne?"":(o==="parameterized"&&Array.isArray(O)?m.push(...O):o==="parameterized_named"&&re(O)&&(Object.assign(d,O),Object.keys(O).forEach(A=>G.get(N.field)?.add(A))),ne)},R=(N,$)=>{if(!pe(N,u[N.id??""]))return $?i:"";let z=N.rules.map(oe=>typeof oe=="string"?oe:D(oe)?R(oe,N.rules.length===1):v(oe));return z.length===0?i:`${N.not?"NOT ":""}(${z.filter(Boolean).join(J(N)?` ${N.combinator} `:" ")})`};return g?{sql:R(e,!0),params:m}:{sql:R(e,!0),params:d}}if(o==="mongodb"){let g=(G,x)=>{if(!pe(G,u[G.id??""]))return x?i:"";let v=`"$${G.combinator.toLowerCase()}"`,R=!1,N=G.rules.map($=>{if(D($)){let _=g($);return _?(R=!0,/^\{.+\}$/.test(_)?_:`{${_}}`):""}let[z,oe]=F($);if(!pe($,z,oe)||$.field===h||$.operator===b)return"";let j=Ae(a,$.field);return(n??r)($,{parseNumbers:f,fieldData:j,format:o})}).filter(Boolean);return N.length>0?N.length===1&&!R?N[0]:`${v}:[${N.join(",")}]`:i},m=J(e)?e:ct(e),d=g(m,!0);return/^\{.+\}$/.test(d)?d:`{${d}}`}if(o==="cel"){let g=(m,d)=>{if(!pe(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return ho[R];if(D(R))return g(R);let[N,$]=F(R);if(!pe(R,N,$)||R.field===h||R.operator===b)return"";let z=Ae(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o})}).filter(Boolean).join(J(m)?` ${ho[m.combinator]} `:" "),[x,v]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="spel"){let g=(m,d)=>{if(!pe(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[N,$]=F(R);if(!pe(R,N,$)||R.field===h||R.operator===b)return"";let z=Ae(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,v]=m.not||!d?[`${m.not?"!":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="jsonata"){let g=(m,d)=>{if(!pe(m,u[m.id??""]))return d?i:"";let G=m.rules.map(R=>{if(typeof R=="string")return R;if(D(R))return g(R);let[N,$]=F(R);if(!pe(R,N,$)||R.field===h||R.operator===b)return"";let z=Ae(a,R.field);return(n??r)(R,{parseNumbers:f,escapeQuotes:(R.valueSource??"value")==="value",fieldData:z,format:o,quoteFieldNamesWith:l})}).filter(Boolean).join(J(m)?` ${m.combinator} `:" "),[x,v]=m.not||!d?[`${m.not?"$not":""}(`,")"]:["",""];return G?`${x}${G}${v}`:i};return g(e,!0)}if(o==="jsonlogic"){let g=J(e)?e:ct(e),m=(d,G)=>{if(!pe(d,u[d.id??""]))return!1;let x=d.rules.map(R=>{if(D(R))return m(R);let[N,$]=F(R);if(!pe(R,N,$)||R.field===h||R.operator===b)return!1;let z=Ae(a,R.field);return(n??r)(R,{parseNumbers:f,fieldData:z,format:o})}).filter(Boolean);if(x.length===0)return!1;let v={[d.combinator]:x};return d.not?{"!":v}:v};return m(g,!0)}if(o==="elasticsearch"){let g=J(e)?e:ct(e),m=G=>{if(!pe(G,u[G.id??""]))return!1;let x=G.rules.map(v=>{if(D(v))return m(v);let[R,N]=F(v);if(!pe(v,R,N)||v.field===h||v.operator===b)return!1;let $=Ae(a,v.field);return(n??r)(v,{parseNumbers:f,fieldData:$,format:o})}).filter(Boolean);return x.length===0?!1:{bool:G.not?{must_not:G.combinator==="or"?{bool:{should:x}}:x}:{[G.combinator==="or"?"should":"must"]:x}}},d=m(g);return d===!1?{}:d}return""}var ar={default:Je,mongodb:dt,cel:pt,spel:mt},Ht=e=>(t,o,r,n)=>ar[e]({field:t,operator:o,value:r,valueSource:n},{parseNumbers:!1}),ua=Ht("default"),ca=Ht("mongodb"),pa=Ht("cel"),da=Ht("spel");var ma=pt,fa=dt,ya=mt;var ye=(e,t)=>{let o=t,r=0;for(;r<e.length&&o&&D(o);){let n=o.rules[e[r]];typeof n!="string"?o=n:o=null,r++}return o},le=e=>e.slice(0,e.length-1),Me=(e,t)=>e.length===t.length&&e.every((o,r)=>o===t[r]),$a=(e,t)=>e.length<t.length&&RegExp(`^${e.join("-")}`).test(t.join("-")),en=(e,t)=>{let o=[],r=le(e),n=le(t),l=0;for(;l<r.length&&l<n.length&&r[l]===n[l];)o.push(n[l]),l++;return o},ft=(e,t)=>{let o=!!t.disabled,r=t,n=0;for(;n<e.length&&!o&&D(r);){let l=r.rules[e[n]];re(l)&&(D(l)||"field"in l&&l.field)&&(o=!!l.disabled,r=l),n++}return o};var tn=e=>Me([],e.path)?"Query builder":`Rule group at path ${e.path.join("-")}`;var St=globalThis.crypto,he=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(St){if(typeof St.randomUUID=="function")he=()=>St.randomUUID();else if(typeof St.getRandomValues=="function"){let e="89ab",t=new Uint32Array(32);he=()=>{St.getRandomValues(t);let o=(t[0]%16).toString(16);for(let r=1;r<32;r++)r===12?o=`${o}4`:r===16?o=`${o}${e[t[17]%4]}`:o=`${o}${(t[r]%16).toString(16)}`,(r===7||r===11||r===15||r===19)&&(o=`${o}-`);return o}}}import*as nn from"react";import{useContext as cr,useMemo as Go}from"react";import on from"clsx";var _t=(...e)=>{let t=o=>on(e.filter(Boolean).map(r=>on(r[o])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}};import{produce as ir}from"immer";var Jt=Object.keys,Da=Object.entries;var ur={},zt=(...e)=>{let[t,...o]=e;return ir(t??ur,r=>{for(let n of o)n&&Jt(n).forEach(l=>{r[l]={...r[l],...n[l]}})})};var qa=e=>{let{key:t,controlClassnames:o,controlElements:r,translations:n}=e;return l=>{let s=cr(nt),a=Go(()=>o?{controlClassnames:_t(s.controlClassnames,l.controlClassnames,o)}:{},[l.controlClassnames,s.controlClassnames]),u=Go(()=>zt(s.translations,n,l.translations),[l.translations,s.translations]),i=Go(()=>({...s,...a,controlElements:{...s.controlElements,...r,...l.controlElements},translations:u}),[a,u,l.controlElements,s]);return nn.createElement(nt.Provider,{value:i,key:t},l.children)}};var Kt=e=>{let t=typeof e=="boolean"?e:typeof e=="object"&&e!==null?e.valid:null;return typeof t=="boolean"?t?w.valid:w.invalid:""};var pr=["value"],dr={name:"name",value:"name",valueSources:null,label:"label"},rn=(e,t,o)=>{let r=e?fe(e):dr;if(r.valueSources)return typeof r.valueSources=="function"?r.valueSources(t):r.valueSources;if(o){let n=o(r.value,t,{fieldData:fe(r)});if(n)return n}return pr};import{produce as ln}from"immer";var sn=(e,{idGenerator:t=he}={})=>ln(e,o=>{o.id||(o.id=t())}),Xt=(e,{idGenerator:t=he}={})=>ln(e,o=>{o.id||(o.id=t()),o.rules=o.rules.map(r=>typeof r=="string"?r:D(r)?Xt(r,{idGenerator:t}):sn(r,{idGenerator:t}))}),an=(e,{idGenerator:t=he}={})=>D(e)?Xt(e,{idGenerator:t}):sn(e,{idGenerator:t});import{produce as eo}from"immer";var Yt=(e,{idGenerator:t=he}={})=>JSON.parse(JSON.stringify({...e,id:t()})),Zt=(e,{idGenerator:t=he}={})=>{if(!re(e))return e;if(!D(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(J(e)){let r=e.rules.map(n=>D(n)?Zt(n,{idGenerator:t}):Yt(n,{idGenerator:t}));return{...e,id:t(),rules:r}}let o=e.rules.map(r=>typeof r=="string"?r:D(r)?Zt(r,{idGenerator:t}):Yt(r,{idGenerator:t}));return{...e,id:t(),rules:o}};var Ao=(e,t,o,{combinators:r=He,combinatorPreceding:n,idGenerator:l=he}={})=>eo(e,s=>{let a=ye(o,s);if(!(!a||!D(a))){if(!J(a)&&a.rules.length>0){let u=a.rules[a.rules.length-2];a.rules.push(n??(typeof u=="string"?u:de(r)))}a.rules.push(an(t,{idGenerator:l}))}}),un=(e,t,o,r,{resetOnFieldChange:n=!0,resetOnOperatorChange:l=!1,getRuleDefaultOperator:s=()=>"=",getValueSources:a=()=>["value"],getRuleDefaultValue:u=()=>""}={})=>eo(e,i=>{if(t==="combinator"&&!J(i)){let b=ye(le(r),i).rules;r[r.length-1]%2===1&&(b[r[r.length-1]]=o);return}let c=ye(r,i);if(!c)return;let p=D(c);if(c[t]===o||(t!=="valueSource"&&(c[t]=o),p))return;let y=!1,f=!1;n&&t==="field"&&(c.operator=s(o),y=!0,f=!0),l&&t==="operator"&&(y=!0,f=!0);let h=a(c.field,c.operator)[0];(y&&c.valueSource&&h!==c.valueSource||t==="valueSource"&&o!==c.valueSource)&&(f=!!c.valueSource||!c.valueSource&&o!==h,c.valueSource=y?h:o),f&&(c.value=u(c))}),cn=(e,t)=>t.length===0||!J(e)&&!ye(t,e)?e:eo(e,o=>{let r=t[t.length-1],n=ye(le(t),o);if(n&&D(n))if(!J(n)&&n.rules.length>1){let l=r===0?0:r-1;n.rules.splice(l,2)}else n.rules.splice(r,1)}),mr=(e,t,o)=>{if(Array.isArray(o))return o;let r=Ye(e);if(o==="up"){if(Me(t,[0]))return t;if(t.at(-1)===0){let n=le(t);return[...le(n),Math.max(0,n.at(-1)-(r?1:0))]}else{let n=[...le(t),Math.max(0,t.at(-1)-(r?2:1))],l=ye(n,e);return D(l)?[...n,l.rules.length]:[...le(t),Math.max(0,t.at(-1)-(r?3:1))]}}else if(o==="down"){if(Me([e.rules.length-1],t))return t;if(t.at(-1)===ye(le(t),e).rules.length-1){let n=le(t);return[...le(n),n.at(-1)+1]}else{let n=[...le(t),t.at(-1)+(r?2:1)],l=ye(n,e);return D(l)?[...n,0]:[...le(t),t.at(-1)+(r?3:2)]}}return t},pn=(e,t,o,{clone:r=!1,combinators:n=He,idGenerator:l=he}={})=>{let s=mr(e,t,o);if(t.length===0||Me(t,s)||!ye(le(s),e))return e;let a=ye(t,e);if(!a)return e;let u=r?D(a)?Zt(a,{idGenerator:l}):Yt(a,{idGenerator:l}):a;return eo(e,i=>{let c=Ye(i),p=ye(le(t),i),y=t[t.length-1],f=c&&y>0?p.rules[y-1]:null,h=c&&y<p.rules.length-1?p.rules[y+1]:null;if(!r){let m=c?Math.max(0,y-1):y,d=c?2:1;p.rules.splice(m,d)}let b=[...s],S=en(t,s);!r&&t.length===S.length+1&&s[S.length]>t[S.length]&&(b[S.length]-=c?2:1);let B=le(b),Q=ye(B,i),F=b[b.length-1],g=(...m)=>Q.rules.splice(F,0,...m);if(Q.rules.length===0||!c)g(u);else if(F===0)if(y===0&&h)g(u,h);else{let m=Q.rules[1]||f||de(n);g(u,m)}else if(f)g(f,u);else{let m=Q.rules[F-2]||h||de(n);g(m,u)}})};import*as to from"react";var dn=e=>It(e)?e.map(t=>to.createElement("optgroup",{key:t.label,label:t.label},t.options.map(o=>to.createElement("option",{key:o.name,value:o.name,disabled:o.disabled},o.label)))):Array.isArray(e)?e.map(t=>to.createElement("option",{key:t.name,value:t.name,disabled:t.disabled},t.label)):null;import{produce as fr}from"immer";var mn=(e,t,o)=>fr(e,r=>{for(let[n,l]of Object.entries(t))l===!1?delete r[n]:l&&n!==l&&n in r&&(r[l]=r[n],o&&delete r[n])});function yi(e,t={}){let{ruleProcessor:o=c=>c,ruleGroupProcessor:r=c=>c,propertyMap:n={},combinatorMap:l={},operatorMap:s={},omitPath:a=!1,deleteRemappedProperties:u=!0}=t,i=c=>({...r(mn({...c,...J(c)?{combinator:l[c.combinator]??c.combinator}:{}},n,u)),...n.rules===!1?null:{[n.rules??"rules"]:c.rules.map((p,y)=>{let f=a?null:{path:[...c.path,y]};return typeof p=="string"?l[p]??p:D(p)?i({...p,...f}):o(mn({...p,...f,..."operator"in p?{operator:s[p.operator]??p.operator}:{}},n,u))})}});return i({...e,...a?null:{path:[]}})}import{useMemo as fn}from"react";var yr=(e,t)=>e===!1?!1:e?!0:t!==!1,hr=(e,t)=>e?!0:e===!1?!1:!!t,br=(e,t,o)=>e?yr(t,o):hr(t,o),oo=(e,t,o)=>fn(()=>br(e,t,o),[o,e,t]),ji=(e,t,o)=>fn(()=>typeof t<"u"&&t!=null?t:typeof o<"u"&&o!=null?o:e,[o,e,t]);var C=()=>null,yn=Rr(C),hn=e=>{let t=gr(nt),o=oo(!0,e.enableMountQueryChange,t.enableMountQueryChange),r=oo(!1,e.enableDragAndDrop,t.enableDragAndDrop)&&t.enableDragAndDrop!==!1,n=oo(!1,e.debugMode,t.debugMode),l=Oo(()=>_t(Io,t.controlClassnames,e.controlClassnames),[t.controlClassnames,e.controlClassnames]),s=Oo(()=>{let b={...t.controlElements,...t.controlElements?.dragHandle===null?{dragHandle:yn}:{},...t.controlElements?.inlineCombinator===null?{inlineCombinator:C}:{},...t.controlElements?.notToggle===null?{notToggle:C}:{},...t.controlElements?.shiftActions===null?{shiftActions:C}:{},...t.controlElements?.valueEditor===null?{valueEditor:C}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...t.controlElements?.addGroupAction===null?{addGroupAction:C}:{},...t.controlElements?.addRuleAction===null?{addRuleAction:C}:{},...t.controlElements?.cloneGroupAction===null?{cloneGroupAction:C}:{},...t.controlElements?.cloneRuleAction===null?{cloneRuleAction:C}:{},...t.controlElements?.lockGroupAction===null?{lockGroupAction:C}:{},...t.controlElements?.lockRuleAction===null?{lockRuleAction:C}:{},...t.controlElements?.removeGroupAction===null?{removeGroupAction:C}:{},...t.controlElements?.removeRuleAction===null?{removeRuleAction:C}:{},...t.controlElements?.combinatorSelector===null?{combinatorSelector:C}:{},...t.controlElements?.fieldSelector===null?{fieldSelector:C}:{},...t.controlElements?.operatorSelector===null?{operatorSelector:C}:{},...t.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...t.controlElements?.actionElement?{addGroupAction:t.controlElements?.addGroupAction===null?C:t.controlElements?.addGroupAction??t.controlElements.actionElement,addRuleAction:t.controlElements?.addRuleAction===null?C:t.controlElements?.addRuleAction??t.controlElements.actionElement,cloneGroupAction:t.controlElements?.cloneGroupAction===null?C:t.controlElements?.cloneGroupAction??t.controlElements.actionElement,cloneRuleAction:t.controlElements?.cloneRuleAction===null?C:t.controlElements?.cloneRuleAction??t.controlElements.actionElement,lockGroupAction:t.controlElements?.lockGroupAction===null?C:t.controlElements?.lockGroupAction??t.controlElements.actionElement,lockRuleAction:t.controlElements?.lockRuleAction===null?C:t.controlElements?.lockRuleAction??t.controlElements.actionElement,removeGroupAction:t.controlElements?.removeGroupAction===null?C:t.controlElements?.removeGroupAction??t.controlElements.actionElement,removeRuleAction:t.controlElements?.removeRuleAction===null?C:t.controlElements?.removeRuleAction??t.controlElements.actionElement}:{},...t.controlElements?.valueSelector?{combinatorSelector:t.controlElements?.combinatorSelector===null?C:t.controlElements?.combinatorSelector??t.controlElements.valueSelector,fieldSelector:t.controlElements?.fieldSelector===null?C:t.controlElements?.fieldSelector??t.controlElements.valueSelector,operatorSelector:t.controlElements?.operatorSelector===null?C:t.controlElements?.operatorSelector??t.controlElements.valueSelector,valueSourceSelector:t.controlElements?.valueSourceSelector===null?C:t.controlElements?.valueSourceSelector??t.controlElements.valueSelector}:{}},S={...e.controlElements,...e.controlElements?.dragHandle===null?{dragHandle:yn}:{},...e.controlElements?.inlineCombinator===null?{inlineCombinator:C}:{},...e.controlElements?.notToggle===null?{notToggle:C}:{},...e.controlElements?.shiftActions===null?{shiftActions:C}:{},...e.controlElements?.valueEditor===null?{valueEditor:C}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...e.controlElements?.addGroupAction===null?{addGroupAction:C}:{},...e.controlElements?.addRuleAction===null?{addRuleAction:C}:{},...e.controlElements?.cloneGroupAction===null?{cloneGroupAction:C}:{},...e.controlElements?.cloneRuleAction===null?{cloneRuleAction:C}:{},...e.controlElements?.lockGroupAction===null?{lockGroupAction:C}:{},...e.controlElements?.lockRuleAction===null?{lockRuleAction:C}:{},...e.controlElements?.removeGroupAction===null?{removeGroupAction:C}:{},...e.controlElements?.removeRuleAction===null?{removeRuleAction:C}:{},...e.controlElements?.combinatorSelector===null?{combinatorSelector:C}:{},...e.controlElements?.fieldSelector===null?{fieldSelector:C}:{},...e.controlElements?.operatorSelector===null?{operatorSelector:C}:{},...e.controlElements?.valueSourceSelector===null?{valueSourceSelector:C}:{},...e.controlElements?.actionElement?{addGroupAction:e.controlElements?.addGroupAction===null?C:e.controlElements?.addGroupAction??e.controlElements.actionElement,addRuleAction:e.controlElements?.addRuleAction===null?C:e.controlElements?.addRuleAction??e.controlElements.actionElement,cloneGroupAction:e.controlElements?.cloneGroupAction===null?C:e.controlElements?.cloneGroupAction??e.controlElements.actionElement,cloneRuleAction:e.controlElements?.cloneRuleAction===null?C:e.controlElements?.cloneRuleAction??e.controlElements.actionElement,lockGroupAction:e.controlElements?.lockGroupAction===null?C:e.controlElements?.lockGroupAction??e.controlElements.actionElement,lockRuleAction:e.controlElements?.lockRuleAction===null?C:e.controlElements?.lockRuleAction??e.controlElements.actionElement,removeGroupAction:e.controlElements?.removeGroupAction===null?C:e.controlElements?.removeGroupAction??e.controlElements.actionElement,removeRuleAction:e.controlElements?.removeRuleAction===null?C:e.controlElements?.removeRuleAction??e.controlElements.actionElement}:{},...e.controlElements?.valueSelector?{combinatorSelector:e.controlElements?.combinatorSelector===null?C:e.controlElements?.combinatorSelector??e.controlElements.valueSelector,fieldSelector:e.controlElements?.fieldSelector===null?C:e.controlElements?.fieldSelector??e.controlElements.valueSelector,operatorSelector:e.controlElements?.operatorSelector===null?C:e.controlElements?.operatorSelector??e.controlElements.valueSelector,valueSourceSelector:e.controlElements?.valueSourceSelector===null?C:e.controlElements?.valueSourceSelector??e.controlElements.valueSelector}:{}};return{...bn,...b,...S}},[e.controlElements,t.controlElements]),a=Oo(()=>zt(wo,t.translations,e.translations),[e.translations,t.translations]),{controlClassnames:u,controlElements:i,debugMode:c,enableDragAndDrop:p,enableMountQueryChange:y,translations:f,...h}=t;return{controlClassnames:l,controlElements:s,debugMode:n,enableDragAndDrop:r,enableMountQueryChange:o,translations:a,...h}};import{clsx as On}from"clsx";import{useCallback as lt,useEffect as Cn,useMemo as Ee}from"react";import{createSlice as xr}from"@reduxjs/toolkit";var Gr={},yt=xr({name:"queries",initialState:Gr,reducers:{setQueryState:(e,{payload:{qbId:t,query:o}})=>{e[t]=o}},selectors:{getQuerySelectorById:(e,t)=>e[t]}});import{configureStore as Ar}from"@reduxjs/toolkit";import*as Rn from"react";import{createSelectorHook as Or}from"react-redux";var Cr={queries:yt.getInitialState()},gn=Ar({reducer:{queries:yt.reducer},preloadedState:Cr,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),ht=Rn.createContext(null),xn=Or(ht),rt=e=>t=>yt.selectors.getQuerySelectorById(t,e);import{createDispatchHook as vr,createStoreHook as $r}from"react-redux";var no=({payload:e,onQueryChange:t})=>o=>{o(yt.actions.setQueryState(e)),typeof t=="function"&&t(e.query)},Gn=vr(ht),An=$r(ht);var Tr={},Sr={},Nr=()=>null,Pr=()=>"",Er=()=>"",Fr=e=>e,Dr=e=>e,wr=()=>!0,Br=(...e)=>{console.log(...e)};function vn(e,t){let{query:o,defaultQuery:r,getValueEditorSeparator:n=Nr,getRuleClassname:l=Pr,getRuleGroupClassname:s=Er,onAddRule:a=Fr,onAddGroup:u=Dr,onRemove:i=wr,onQueryChange:c,showCombinatorsBetweenRules:p=!1,showNotToggle:y=!1,showShiftActions:f=!1,showCloneButtons:h=!1,showLockButtons:b=!1,resetOnFieldChange:S=!0,resetOnOperatorChange:B=!1,autoSelectField:Q=!0,autoSelectOperator:F=!0,addRuleToNewGroups:g=!1,listsAsArrays:m=!1,parseNumbers:d=!1,disabled:G=!1,validator:x,onLog:v=Br,idGenerator:R,accessibleDescriptionGenerator:N=tn}=e,{qbId:$,rqbContext:z,fields:oe,fieldMap:j,combinators:_,getOperatorsMain:ne,getRuleDefaultOperator:O,getValueEditorTypeMain:A,getValueSourcesMain:ae,getValuesMain:Ie,getRuleDefaultValue:ke,getInputTypeMain:Qe,createRule:De,createRuleGroup:Oe}=t,{controlClassnames:Ce,controlElements:L,debugMode:X,enableDragAndDrop:me,enableMountQueryChange:je,translations:P}=z,T=!!p,E=!!y,ie=!!f,ue=!!h,Ke=!!b,ve=!!S,Xe=!!B,Z=!!Q,ee=!!F,Re=!!g,at=!!m,K=An(),$e=Gn(),it=Ee(()=>rt(t.qbId),[t.qbId]),so=xn(it),Co=lt(()=>it(K.getState()),[K,it]),Qn=Ee(()=>Oe(),[Oe]),ao=o??so??r??Qn,Te=ao.id?ao:Xt(ao,{idGenerator:R});Cn(()=>{o&&o!==so&&$e(no({payload:{qbId:$,query:o},onQueryChange:void 0}))},[o,$,so,$e]);let xt=Ee(()=>Ye(Te),[Te]),io=!!e.independentCombinators&&!xt;io||!io&&e.independentCombinators,Cn(()=>{$e(no({payload:{qbId:$,query:Te},onQueryChange:je&&typeof c=="function"?c:void 0}))},[]);let Se=lt(V=>{$e(no({payload:{qbId:$,query:V},onQueryChange:c}))},[c,$,$e]),Nt=Ee(()=>Array.isArray(G)&&G||[],[G]),Ge=G===!0,Ln=Ee(()=>Te.disabled||Nt.some(V=>V.length===0),[Nt,Te.disabled]),vo=lt((V,Y,se)=>{let q=rt($)(K.getState());if(!q)return;if(ft(Y,q)||Ge){X&&v({type:ge.parentPathDisabled,rule:V,parentPath:Y,query:q});return}let ce=a(V,Y,q,se);if(!ce){X&&v({type:ge.onAddRuleFalse,rule:V,parentPath:Y,query:q});return}let At=Ao(q,ce,Y,{combinators:_,combinatorPreceding:ce.combinatorPreceding??void 0});X&&v({type:ge.add,query:q,newQuery:At,newRule:ce,parentPath:Y}),Se(At)},[_,X,Se,a,v,$,Ge,K]),$o=lt((V,Y,se)=>{let q=rt($)(K.getState());if(!q)return;if(ft(Y,q)||Ge){X&&v({type:ge.parentPathDisabled,ruleGroup:V,parentPath:Y,query:q});return}let ce=u(V,Y,q,se);if(!ce){X&&v({type:ge.onAddGroupFalse,ruleGroup:V,parentPath:Y,query:q});return}let At=Ao(q,ce,Y,{combinators:_,combinatorPreceding:ce.combinatorPreceding??void 0});X&&v({type:ge.add,query:q,newQuery:At,newGroup:ce,parentPath:Y}),Se(At)},[_,X,Se,u,v,$,Ge,K]),To=lt((V,Y,se)=>{let q=rt($)(K.getState());if(!q)return;if(ft(se,q)&&V!=="disabled"||Ge){X&&v({type:ge.pathDisabled,path:se,prop:V,value:Y,query:q});return}let ce=un(q,V,Y,se,{resetOnFieldChange:ve,resetOnOperatorChange:Xe,getRuleDefaultOperator:O,getValueSources:ae,getRuleDefaultValue:ke});X&&v({type:ge.update,query:q,newQuery:ce,prop:V,value:Y,path:se}),Se(ce)},[X,Se,O,ke,ae,v,$,Ge,K,ve,Xe]),uo=lt((V,Y)=>{let se=rt($)(K.getState());if(!se)return;if(ft(V,se)||Ge){X&&v({type:ge.pathDisabled,path:V,query:se});return}let q=ye(V,se);if(q)if(i(q,V,se,Y)){let ce=cn(se,V);X&&v({type:ge.remove,query:se,newQuery:ce,path:V,ruleOrGroup:q}),Se(ce)}else X&&v({type:ge.onRemoveFalse,ruleOrGroup:q,path:V,query:se})},[X,Se,v,i,$,Ge,K]),So=lt((V,Y,se)=>{let q=rt($)(K.getState());if(!q)return;if(ft(V,q)||Ge){X&&v({type:ge.pathDisabled,oldPath:V,newPath:Y,query:q});return}let ce=pn(q,V,Y,{clone:se,combinators:_});X&&v({type:ge.move,query:q,newQuery:ce,oldPath:V,newPath:Y,clone:se}),Se(ce)},[_,X,Se,v,$,Ge,K]),Vn=Ee(()=>me?"enabled":"disabled",[me]),Mn=Ee(()=>xt||T?"enabled":"disabled",[xt,T]),qn=Ee(()=>J(Te)?{combinator:Te.combinator}:{},[Te]),{validationResult:Gt,validationMap:No}=Ee(()=>{let V=typeof x=="function"&&Te?x(Te):Tr;return{validationResult:V,validationMap:typeof V=="boolean"?Sr:V}},[Te,x]),Wn=Ee(()=>({addRuleToNewGroups:Re,accessibleDescriptionGenerator:N,autoSelectField:Z,autoSelectOperator:ee,classNames:Ce,combinators:_,controls:L,createRule:De,createRuleGroup:Oe,disabledPaths:Nt,enableDragAndDrop:me,fieldMap:j,fields:oe,dispatchQuery:Se,getQuery:Co,getInputType:Qe,getOperators:ne,getRuleClassname:l,getRuleGroupClassname:s,getValueEditorSeparator:n,getValueEditorType:A,getValues:Ie,getValueSources:ae,independentCombinators:xt,listsAsArrays:at,parseNumbers:d,qbId:$,showCloneButtons:ue,showCombinatorsBetweenRules:T,showLockButtons:Ke,showNotToggle:E,showShiftActions:ie,validationMap:No}),[Re,N,Z,ee,_,Ce,L,De,Oe,Nt,me,j,oe,Se,Co,Qe,ne,l,s,A,Ie,ae,n,xt,at,d,$,ue,T,Ke,E,ie,No]),Un=Ee(()=>({moveRule:So,onGroupAdd:$o,onGroupRemove:uo,onPropChange:To,onRuleAdd:vo,onRuleRemove:uo}),[So,$o,To,vo,uo]),jn=Ee(()=>On(w.queryBuilder,On(Ce.queryBuilder),{[w.disabled]:Ge,[w.valid]:typeof Gt=="boolean"&&Gt,[w.invalid]:typeof Gt=="boolean"&&!Gt}),[Ce.queryBuilder,Ge,Gt]);return{...e,actions:Un,rootGroup:Te,rootGroupDisabled:Ln,queryDisabled:Ge,rqbContext:z,schema:Wn,translations:P,wrapperClassName:jn,dndEnabledAttr:Vn,inlineCombinatorsAttr:Mn,combinatorPropObject:qn}}import{useCallback as ze,useMemo as bt,useState as Ir}from"react";var $n=(e,t,o)=>{let r=de(e);if(t.operator==="between"||t.operator==="notBetween"){let n=[r,r];return o?n:ut(n.map(l=>l??""),",")}return r},Tn=e=>{let[t]=Ir(he),{query:o,defaultQuery:r,fields:n,baseField:l,operators:s,baseOperator:a,combinators:u=He,baseCombinator:i,translations:c,enableMountQueryChange:p=!0,controlClassnames:y,controlElements:f,getDefaultField:h,getDefaultOperator:b,getDefaultValue:S,getOperators:B,getValueEditorType:Q,getValueSources:F,getInputType:g,getValues:m,autoSelectField:d=!0,autoSelectOperator:G=!0,addRuleToNewGroups:x=!1,enableDragAndDrop:v,listsAsArrays:R=!1,debugMode:N=!1,idGenerator:$=he}=e,z=s??Bo,oe=hn({controlClassnames:y,controlElements:f,debugMode:N,enableDragAndDrop:v,enableMountQueryChange:p,translations:c}),{translations:j}=oe,_=bt(()=>({id:j.fields.placeholderName,name:j.fields.placeholderName,value:j.fields.placeholderName,label:j.fields.placeholderLabel}),[j.fields.placeholderLabel,j.fields.placeholderName]),ne=bt(()=>n??[_],[_,n]),O=bt(()=>{let P=Array.isArray(ne)?Ve(ne,l):Jt(fo(ne,l)).map(T=>({...ne[T],name:T,value:T})).sort((T,E)=>T.label.localeCompare(E.label));return Ne(P)?d?Bt(P):Bt([{label:j.fields.placeholderGroupLabel,options:[_]},...P]):d?et(P):et([_,...P])},[d,l,_,ne,j.fields.placeholderGroupLabel]),A=bt(()=>{if(!Array.isArray(ne)){let T=fo(ne,l);return d?T:{...T,[j.fields.placeholderName]:_}}let P={};return Ne(O)?O.forEach(T=>T.options.forEach(E=>{P[E.value??E.name]=fe(E,l)})):O.forEach(T=>{P[T.value??T.name]=fe(T,l)}),P},[d,l,_,O,ne,j.fields.placeholderName]),ae=bt(()=>Ve(u,i),[i,u]),Ie=bt(()=>({id:j.operators.placeholderName,name:j.operators.placeholderName,value:j.operators.placeholderName,label:j.operators.placeholderLabel}),[j.operators.placeholderLabel,j.operators.placeholderName]),ke=ze((P,{fieldData:T})=>{let E=Ve(z,a);if(T?.operators)E=Ve(T.operators,a);else if(B){let ie=B(P,{fieldData:T});ie&&(E=Ve(ie,a))}return G||(Ne(E)?E=[{label:j.operators.placeholderGroupLabel,options:[Ie]},...E]:E=[Ie,...E]),Jo(E)},[G,a,Ie,B,z,j.operators.placeholderGroupLabel]),Qe=ze(P=>{let T=A[P];if(T?.defaultOperator)return T.defaultOperator;if(b)return typeof b=="function"?b(P,{fieldData:T}):b;let E=ke(P,{fieldData:T})??[];return de(E)??""},[A,b,ke]),De=ze((P,T,{fieldData:E})=>E.valueEditorType?typeof E.valueEditorType=="function"?E.valueEditorType(T):E.valueEditorType:Q?.(P,T,{fieldData:E})??"text",[Q]),Oe=ze((P,T)=>rn(A[P],T,F),[A,F]),Ce=ze((P,T,{fieldData:E})=>E?.values?Ve(E.values):m?Ve(m(P,T,{fieldData:E})):[],[m]),L=ze(P=>{let T=A[P.field]??{};if(T?.defaultValue!==void 0&&T.defaultValue!==null)return T.defaultValue;if(S)return S(P,{fieldData:T});let E="",ie=Ce(P.field,P.operator,{fieldData:T});if(P.valueSource==="field"){let ue=kt(T,O,P.operator);ue.length>0?E=$n(ue,P,R):E=""}else if(ie.length){let ue=De(P.field,P.operator,{fieldData:T});ue==="multiselect"?E=R?[]:"":(ue==="select"||ue==="radio")&&(E=$n(ie,P,R))}else De(P.field,P.operator,{fieldData:T})==="checkbox"&&(E=!1);return E},[A,O,S,De,Ce,R]),X=ze((P,T,{fieldData:E})=>{if(g){let ie=g(P,T,{fieldData:E});if(ie)return ie}return"text"},[g]),me=ze(()=>{let P="",T=O;if(T?.length>0&&T[0]){let ve=de(T);ve&&(P=ve)}if(h)if(typeof h=="function"){let ve=h(T);ve&&(P=ve)}else P=h;let E=Qe(P),ie=Oe(P,E)[0]??"value",ue={id:$(),field:P,operator:E,valueSource:ie,value:""},Ke=L(ue);return{...ue,value:Ke}},[O,h,Qe,L,Oe,$]),je=ze(P=>P?{id:$(),rules:x?[me()]:[],not:!1}:{id:$(),rules:x?[me()]:[],combinator:de(ae)??"",not:!1},[x,ae,me,$]);return Vo({defaultQuery:r,queryProp:o}),{qbId:t,rqbContext:oe,fields:O,fieldMap:A,combinators:ae,getOperatorsMain:ke,getRuleDefaultOperator:Qe,getValueEditorTypeMain:De,getValueSourcesMain:Oe,getValuesMain:Ce,getRuleDefaultValue:L,getInputTypeMain:X,createRule:me,createRuleGroup:je}};var ro=(e,t)=>{};import{clsx as qe}from"clsx";import{useCallback as Rt,useMemo as be}from"react";var Sn=e=>{let{id:t,path:o,rule:r,schema:n,actions:{moveRule:l,onPropChange:s,onRuleRemove:a},disabled:u,parentDisabled:i,shiftUpDisabled:c,shiftDownDisabled:p,field:y,operator:f,value:h,valueSource:b,dragMonitorId:S="",dropMonitorId:B="",dndRef:Q=null,dragRef:F=null,isDragging:g=!1,isOver:m=!1}=e,{classNames:d,fields:G,fieldMap:x,getInputType:v,getOperators:R,getValueEditorType:N,getValueEditorSeparator:$,getValueSources:z,getValues:oe,validationMap:j,enableDragAndDrop:_,getRuleClassname:ne}=n;ro(_,!!(S||B||Q||F));let O=!!i||!!u,A=be(()=>r||{id:t,field:y??"",operator:f??"",value:h,valueSource:b},[y,t,f,r,h,b]),ae=be(()=>({shiftActions:qe(w.shiftActions,d.shiftActions),dragHandle:qe(w.dragHandle,d.dragHandle),fields:qe(w.fields,d.valueSelector,d.fields),operators:qe(w.operators,d.valueSelector,d.operators),valueSource:qe(w.valueSource,d.valueSelector,d.valueSource),value:qe(w.value,d.value),cloneRule:qe(w.cloneRule,d.actionElement,d.cloneRule),lockRule:qe(w.lockRule,d.actionElement,d.lockRule),removeRule:qe(w.removeRule,d.actionElement,d.removeRule)}),[d.shiftActions,d.dragHandle,d.valueSelector,d.fields,d.operators,d.valueSource,d.value,d.actionElement,d.cloneRule,d.lockRule,d.removeRule]),Ie=Rt(K=>($e,it)=>{O||s(K,$e,o)},[O,s,o]),ke=Rt((K,$e)=>{if(!O){let it=[...le(o),o[o.length-1]+1];l(o,it,!0)}},[O,l,o]),Qe=Rt((K,$e)=>{s("disabled",!O,o)},[O,s,o]),De=Rt((K,$e)=>{O||a(o)},[O,a,o]),Oe=Rt((K,$e)=>{!O&&!c&&l(o,"up",K?.altKey)},[O,l,o,c]),Ce=Rt((K,$e)=>{!O&&!p&&l(o,"down",K?.altKey)},[O,l,o,p]),L=be(()=>x?.[A.field]??{name:A.field,value:A.field,label:A.field},[x,A.field]),X=be(()=>L.inputType??v(A.field,A.operator,{fieldData:L}),[L,v,A.field,A.operator]),me=be(()=>R(A.field,{fieldData:L}),[L,R,A.field]),je=be(()=>Ae(me,A.operator),[me,A.operator]),P=je?.arity,T=typeof P=="string"&&P==="unary"||typeof P=="number"&&P<2,E=be(()=>typeof L.valueSources=="function"?L.valueSources(A.operator):L.valueSources??z(A.field,A.operator,{fieldData:L}),[L,z,A.field,A.operator]),ie=be(()=>A.valueSource==="field"?"select":N(A.field,A.operator,{fieldData:L}),[L,N,A.field,A.operator,A.valueSource]),ue=be(()=>$(A.field,A.operator,{fieldData:L}),[L,$,A.field,A.operator]),Ke=be(()=>A.valueSource==="field"?kt(L,G,A.operator):L.values??oe(A.field,A.operator,{fieldData:L}),[L,G,oe,A.field,A.operator,A.valueSource]),ve=be(()=>E.map(K=>({name:K,value:K,label:K})),[E]),Xe=be(()=>j[t??""]??(typeof L.validator=="function"?L.validator(A):null),[L,t,A,j]),Z=be(()=>Kt(Xe),[Xe]),ee=be(()=>L?.className??"",[L?.className]),Re=be(()=>je?.className??"",[je?.className]),at=qe(ne(A,{fieldData:L}),ee,Re,w.rule,d.rule,{[w.disabled]:O,[w.dndDragging]:g,[w.dndOver]:m},Z);return{...e,classNames:ae,cloneRule:ke,disabled:O,dndRef:Q,dragMonitorId:S,dragRef:F,dropMonitorId:B,fieldData:L,generateOnChangeHandler:Ie,hideValueControls:T,inputType:X,operators:me,outerClassName:at,removeRule:De,rule:A,shiftRuleUp:Oe,shiftRuleDown:Ce,toggleLockRule:Qe,validationResult:Xe,valueEditorSeparator:ue,valueEditorType:ie,values:Ke,valueSourceOptions:ve,valueSources:E}};import{clsx as Fe}from"clsx";import{useCallback as We,useMemo as Ue}from"react";var Nn=e=>{let{id:t,path:o,ruleGroup:r,schema:{qbId:n,accessibleDescriptionGenerator:l,classNames:s,combinators:a,createRule:u,createRuleGroup:i,disabledPaths:c,independentCombinators:p,validationMap:y,enableDragAndDrop:f,getRuleGroupClassname:h},actions:{onGroupAdd:b,onGroupRemove:S,onPropChange:B,onRuleAdd:Q,moveRule:F},disabled:g,parentDisabled:m,shiftUpDisabled:d,shiftDownDisabled:G,combinator:x,rules:v,not:R,dragMonitorId:N="",dropMonitorId:$="",previewRef:z=null,dragRef:oe=null,dropRef:j=null,isDragging:_=!1,isOver:ne=!1}=e;ro(f,!!(N||$||z||oe||j));let O=!!m||!!g,A=Ue(()=>r&&J(r)?r.combinator:r?de(a):x??de(a),[x,a,r]),ae=Ue(()=>r?{...r,...p?{}:{combinator:A}}:{rules:v,not:R},[A,p,R,r,v]),Ie=Ue(()=>({header:Fe(w.header,s.header,{[w.dndOver]:ne}),shiftActions:Fe(w.shiftActions,s.shiftActions),dragHandle:Fe(w.dragHandle,s.dragHandle),combinators:Fe(w.combinators,s.valueSelector,s.combinators),notToggle:Fe(w.notToggle,s.notToggle),addRule:Fe(w.addRule,s.actionElement,s.addRule),addGroup:Fe(w.addGroup,s.actionElement,s.addGroup),cloneGroup:Fe(w.cloneGroup,s.actionElement,s.cloneGroup),lockGroup:Fe(w.lockGroup,s.actionElement,s.lockGroup),removeGroup:Fe(w.removeGroup,s.actionElement,s.removeGroup),body:Fe(w.body,s.body)}),[s.actionElement,s.addGroup,s.addRule,s.body,s.cloneGroup,s.combinators,s.dragHandle,s.header,s.lockGroup,s.notToggle,s.removeGroup,s.shiftActions,s.valueSelector,ne]),ke=We((Z,ee)=>{O||B("combinator",Z,o)},[O,B,o]),Qe=We((Z,ee,Re)=>{O||B("combinator",Z,o.concat([ee]))},[O,B,o]),De=We((Z,ee)=>{O||B("not",Z,o)},[O,B,o]),Oe=We((Z,ee)=>{if(!O){let Re=u();Q(Re,o,ee)}},[u,O,Q,o]),Ce=We((Z,ee)=>{if(!O){let Re=i(p);b(Re,o,ee)}},[i,O,p,b,o]),L=We((Z,ee)=>{if(!O){let Re=[...le(o),o[o.length-1]+1];F(o,Re,!0)}},[O,F,o]),X=We((Z,ee)=>{!O&&!d&&F(o,"up",Z?.altKey)},[O,F,o,d]),me=We((Z,ee)=>{!O&&!G&&F(o,"down",Z?.altKey)},[O,F,o,G]),je=We((Z,ee)=>{B("disabled",!O,o)},[O,B,o]),P=We((Z,ee)=>{O||S(o)},[O,S,o]),T=Ue(()=>y[t??""],[t,y]),E=Ue(()=>Kt(T),[T]),ie=Ue(()=>p?null:Ae(a,A)?.className??"",[A,a,p]),ue=Ue(()=>h(ae),[h,ae]),Ke=Ue(()=>Fe(ue,ie,w.ruleGroup,s.ruleGroup,{[w.disabled]:O,[w.dndDragging]:_},E),[s.ruleGroup,ie,O,ue,_,E]),ve=Ue(()=>{let Z=[];for(let ee=0;ee<ae.rules.length;ee++){let Re=[...o,ee];Z[ee]={path:Re,disabled:O||c.some(at=>Me(Re,at))}}return Z},[O,o,ae.rules.length,c]),Xe=Ue(()=>l({path:o,qbId:n}),[l,o,n]);return{...e,addGroup:Ce,addRule:Oe,accessibleDescription:Xe,classNames:Ie,cloneGroup:L,combinator:A,disabled:O,dragMonitorId:N,dragRef:oe,dropMonitorId:$,dropRef:j,isDragging:_,isOver:ne,onCombinatorChange:ke,onGroupAdd:b,onIndependentCombinatorChange:Qe,onNotToggleChange:De,outerClassName:Ke,parentDisabled:m,pathsMemo:ve,previewRef:z,removeGroup:P,ruleGroup:ae,shiftGroupUp:X,shiftGroupDown:me,toggleLockGroup:je,validationClassName:E,validationResult:T}};import{useMemo as kr}from"react";var Pn=e=>{let{multiple:t,onChange:o}=e;return kr(()=>t?n=>o(Array.from(n.target.selectedOptions).map(l=>l.value)):n=>o(n.target.value),[t,o])};import{useCallback as Qr}from"react";var xe=e=>Qr((t,o)=>{t?.preventDefault(),t?.stopPropagation(),e(t,o)},[e]);import{produce as Lr}from"immer";import{useCallback as Vr,useEffect as Mr,useMemo as qr}from"react";var En=e=>{let{handleOnChange:t,inputType:o,operator:r,value:n,listsAsArrays:l,parseNumbers:s,values:a,type:u,skipHook:i}=e;Mr(()=>{!i&&u!=="multiselect"&&!["between","notBetween","in","notIn"].includes(r)&&(Array.isArray(n)||o==="number"&&typeof n=="string"&&n.includes(","))&&t(M(n)[0]??"")},[t,o,r,i,u,n]);let c=qr(()=>M(n),[n]),p=Vr((y,f)=>{let h=Lr(c,b=>{b[f]=H(y,{parseNumbers:s}),f===0&&(r==="between"||r==="notBetween")&&(b.length<2||typeof b[1]>"u")&&(b[1]=de(a))});t(l?h:ut(h,","))},[t,l,r,s,c,a]);return{valueAsArray:c,multiValueHandler:p}};import{useCallback as Wr,useMemo as Ur}from"react";var Fn=e=>{let{handleOnChange:t,listsAsArrays:o=!1,multiple:r=!1,value:n}=e,l=Wr(a=>{if(r){let u=M(a);t(o?u:ut(u,","))}else t(a)},[t,o,r]),s=Ur(()=>r?M(n):n,[r,n]);return{onChange:l,val:s}};import{createContext as jr}from"react";var nt=jr({});var _r=[],Jr=e=>st.createElement(Hr,{context:ht,store:gn},e.children),zr=e=>{let{setup:t,props:o}=e,r=vn(o,t),n=r.schema.controls.ruleGroup;return st.createElement(nt.Provider,{key:r.dndEnabledAttr,value:r.rqbContext},st.createElement("div",{role:"form",className:r.wrapperClassName,"data-dnd":r.dndEnabledAttr,"data-inlinecombinators":r.inlineCombinatorsAttr},st.createElement(n,{translations:r.translations,ruleGroup:r.rootGroup,rules:r.rootGroup.rules,...r.combinatorPropObject,not:!!r.rootGroup.not,schema:r.schema,actions:r.actions,id:r.rootGroup.id,path:_r,disabled:r.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:r.queryDisabled,context:r.context})))},Kr=e=>{let t=Tn(e);return st.createElement(Jr,null,st.createElement(zr,{props:e,setup:t}))};import*as te from"react";var Dn=te.memo(e=>{let t=Sn(e);return t.cloneRule=xe(t.cloneRule),t.toggleLockRule=xe(t.toggleLockRule),t.removeRule=xe(t.removeRule),t.shiftRuleUp=xe(t.shiftRuleUp),t.shiftRuleDown=xe(t.shiftRuleDown),te.createElement("div",{ref:t.dndRef,"data-testid":k.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},te.createElement(Xr,{...t}))}),Xr=te.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,fieldSelector:r,operatorSelector:n,valueSourceSelector:l,valueEditor:s,cloneRuleAction:a,lockRuleAction:u,removeRuleAction:i}},combinator:c}=e;return te.createElement(te.Fragment,null,e.schema.showShiftActions&&te.createElement(t,{testID:k.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&te.createElement(o,{testID:k.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),c,te.createElement(r,{testID:k.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&te.createElement(te.Fragment,null,te.createElement(n,{testID:k.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&te.createElement(te.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&te.createElement(l,{testID:k.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),te.createElement(s,{testID:k.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&te.createElement(a,{testID:k.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&te.createElement(u,{testID:k.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),te.createElement(i,{testID:k.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))});import*as U from"react";import{Fragment as Yr}from"react";var wn=U.memo(e=>{let t=Nn(e);return t.addRule=xe(t.addRule),t.addGroup=xe(t.addGroup),t.cloneGroup=xe(t.cloneGroup),t.toggleLockGroup=xe(t.toggleLockGroup),t.removeGroup=xe(t.removeGroup),t.shiftGroupUp=xe(t.shiftGroupUp),t.shiftGroupDown=xe(t.shiftGroupDown),U.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":k.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},U.createElement("div",{ref:t.dropRef,className:t.classNames.header},U.createElement(Zr,{...t})),U.createElement("div",{className:t.classNames.body},U.createElement(el,{...t})))}),Zr=U.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:o,combinatorSelector:r,notToggle:n,addRuleAction:l,addGroupAction:s,cloneGroupAction:a,lockGroupAction:u,removeGroupAction:i}}}=e;return U.createElement(U.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&U.createElement(t,{key:k.shiftActions,testID:k.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&U.createElement(o,{key:k.dragHandle,testID:k.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&U.createElement(r,{key:k.combinators,testID:k.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&U.createElement(n,{key:k.notToggle,testID:k.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),U.createElement(l,{key:k.addRule,testID:k.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),U.createElement(s,{key:k.addGroup,testID:k.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&U.createElement(a,{key:k.cloneGroup,testID:k.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&U.createElement(u,{key:k.lockGroup,testID:k.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&U.createElement(i,{key:k.removeGroup,testID:k.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),el=U.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:o,ruleGroup:r,rule:n}}}=e;return U.createElement(U.Fragment,null,e.ruleGroup.rules.map((l,s,{length:a})=>{let u=e.pathsMemo[s],i=u.path,c=u.disabled||typeof l!="string"&&l.disabled,p=Me([0],i),y=e.path.length===0&&s===a-1,f=typeof l=="string"?[...i,l].join("-"):l.id;return U.createElement(Yr,{key:f},typeof l=="string"?U.createElement(o,{key:`${k.inlineCombinator}-independent`,options:e.schema.combinators,value:l,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:h=>e.onIndependentCombinatorChange(h,s),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:i,disabled:c,schema:e.schema}):D(l)?U.createElement(r,{key:k.ruleGroup,id:l.id,schema:e.schema,actions:e.actions,path:i,translations:e.translations,ruleGroup:l,rules:l.rules,combinator:J(l)?l.combinator:void 0,not:!!l.not,disabled:c,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context}):U.createElement(n,{key:k.rule,id:l.id,rule:l,field:l.field,operator:l.operator,value:l.value,valueSource:l.valueSource,schema:e.schema,actions:e.actions,path:i,disabled:c,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:p,shiftDownDisabled:y,context:e.context,combinator:s===1&&!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules?U.createElement(o,{key:k.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:i,disabled:e.disabled,schema:e.schema}):s>1?U.createElement("span",null,e.combinator):e.path.length===0?U.createElement("span",null,"Where"):U.createElement("span",null)}))}))});import*as lo from"react";var Bn=e=>lo.createElement("div",{"data-testid":e.testID,className:e.className},lo.createElement("button",{disabled:e.disabled||e.shiftUpDisabled,onClick:e.shiftUp,title:e.titles?.shiftUp},e.labels?.shiftUp),lo.createElement("button",{disabled:e.disabled||e.shiftDownDisabled,onClick:e.shiftDown,title:e.titles?.shiftDown},e.labels?.shiftDown));import*as Be from"react";var In=e=>{let{operator:t,value:o,handleOnChange:r,title:n,className:l,type:s="text",inputType:a="text",values:u=[],listsAsArrays:i,parseNumbers:c,fieldData:p,disabled:y,separator:f=null,testID:h,selectorComponent:b=e.schema.controls.valueSelector,...S}=e,{valueAsArray:B,multiValueHandler:Q}=En(e);if(t==="null"||t==="notNull")return null;let F=p?.placeholder??"",g=["in","notIn"].includes(t)?"text":a||"text";if((t==="between"||t==="notBetween")&&(s==="select"||s==="text")){let m=["from","to"].map((d,G)=>s==="text"?Be.createElement("input",{key:d,type:g,placeholder:F,value:B[G]??"",className:w.valueListItem,disabled:y,onChange:x=>Q(x.target.value,G)}):Be.createElement(b,{...S,schema:e.schema,key:d,className:w.valueListItem,handleOnChange:x=>Q(x,G),disabled:y,value:B[G]??de(u),options:u,listsAsArrays:i}));return Be.createElement("span",{"data-testid":h,className:l,title:n},m[0],f,m[1])}switch(s){case"select":case"multiselect":return Be.createElement(b,{...S,schema:e.schema,testID:h,className:l,title:n,handleOnChange:r,disabled:y,value:o,options:u,multiple:s==="multiselect",listsAsArrays:i});case"textarea":return Be.createElement("textarea",{"data-testid":h,placeholder:F,value:o,title:n,className:l,disabled:y,onChange:m=>r(m.target.value)});case"switch":case"checkbox":return Be.createElement("input",{"data-testid":h,type:"checkbox",className:l,title:n,onChange:m=>r(m.target.checked),checked:!!o,disabled:y});case"radio":return Be.createElement("span",{"data-testid":h,className:l,title:n},u.map(m=>Be.createElement("label",{key:m.name},Be.createElement("input",{type:"radio",value:m.name,disabled:y,checked:o===m.name,onChange:d=>r(d.target.value)}),m.label)))}return Be.createElement("input",{"data-testid":h,type:g,placeholder:F,value:o,title:n,className:l,disabled:y,onChange:m=>r(H(m.target.value,{parseNumbers:c}))})};import*as kn from"react";var gt=e=>{let{onChange:t,val:o}=Fn(e),r=Pn({multiple:e.multiple,onChange:t});return kn.createElement("select",{"data-testid":e.testID,className:e.className,value:o,title:e.title,disabled:e.disabled,multiple:!!e.multiple,onChange:r},dn(e.options))};var bn={actionElement:Le,addGroupAction:Le,addRuleAction:Le,cloneGroupAction:Le,cloneRuleAction:Le,combinatorSelector:gt,dragHandle:Fo,fieldSelector:gt,inlineCombinator:ko,lockGroupAction:Le,lockRuleAction:Le,notToggle:Qo,operatorSelector:gt,removeGroupAction:Le,removeRuleAction:Le,rule:Dn,ruleGroup:wn,shiftActions:Bn,valueEditor:In,valueSelector:gt,valueSourceSelector:gt};export{Le as ActionElement,Fo as DragHandle,ko as InlineCombinator,ge as LogType,Qo as NotToggle,Kr as QueryBuilder,nt as QueryBuilderContext,ht as QueryBuilderStateContext,Jr as QueryBuilderStateProvider,Dn as Rule,Xr as RuleComponents,wn as RuleGroup,el as RuleGroupBodyComponents,Zr as RuleGroupHeaderComponents,Bn as ShiftActions,k as TestID,In as ValueEditor,gt as ValueSelector,Ao as add,ct as convertFromIC,Nl as convertQuery,Uo as convertToIC,Kr as default,pa as defaultCELValueProcessor,He as defaultCombinators,ll as defaultCombinatorsExtended,Io as defaultControlClassnames,bn as defaultControlElements,Dt as defaultJoinChar,ca as defaultMongoDBValueProcessor,rl as defaultOperatorNegationMap,Bo as defaultOperators,Jn as defaultPlaceholderFieldGroupLabel,_n as defaultPlaceholderFieldLabel,Et as defaultPlaceholderFieldName,Kn as defaultPlaceholderOperatorGroupLabel,zn as defaultPlaceholderOperatorLabel,Ft as defaultPlaceholderOperatorName,pt as defaultRuleProcessorCEL,qt as defaultRuleProcessorElasticSearch,Ut as defaultRuleProcessorJSONata,jt as defaultRuleProcessorJsonLogic,dt as defaultRuleProcessorMongoDB,Tt as defaultRuleProcessorParameterized,xo as defaultRuleProcessorSQL,mt as defaultRuleProcessorSpEL,da as defaultSpELValueProcessor,wo as defaultTranslations,Dl as defaultValidator,ua as defaultValueProcessor,Je as defaultValueProcessorByRule,ma as defaultValueProcessorCELByRule,fa as defaultValueProcessorMongoDBByRule,ya as defaultValueProcessorSpELByRule,kt as filterFieldsByComparator,ye as findPath,na as formatQuery,tn as generateAccessibleDescription,he as generateID,en as getCommonAncestorPath,qa as getCompatContextProvider,de as getFirstOption,Ae as getOption,le as getParentPath,rt as getQuerySelectorById,Kt as getValidationClassNames,rn as getValueSourcesUtil,wt as groupInvalidReasons,$a as isAncestor,Ne as isFlexibleOptionGroupArray,jl as isFullOptionGroupArray,It as isOptionGroupArray,re as isPojo,D as isRuleGroup,J as isRuleGroupType,Ye as isRuleGroupTypeIC,pe as isRuleOrGroupValid,Zo as isValidationResult,ut as joinWith,tr as jsonLogicAdditionalOperators,_t as mergeClassnames,zt as mergeTranslations,cl as messages,pn as move,Al as nullFreeArray,Mo as numericRegex,Da as objectEntries,Jt as objectKeys,H as parseNumber,ft as pathIsDisabled,Me as pathsAreEqual,sn as prepareRule,Xt as prepareRuleGroup,an as prepareRuleOrGroup,gn as queryBuilderStore,Yt as regenerateID,Zt as regenerateIDs,cn as remove,_r as rootPath,Yn as splitBy,w as standardClassnames,M as toArray,zo as toFlatOptionArray,fe as toFullOption,Ve as toFullOptionList,fo as toFullOptionMap,dn as toOptions,yi as transformQuery,W as trimIfString,et as uniqByIdentifier,Ml as uniqByName,Bt as uniqOptGroups,Jo as uniqOptList,un as update,Vo as useControlledOrUncontrolled,mo as useDeprecatedProps,hn as useMergedContext,ji as usePreferAnyProp,oo as usePreferProp,Lo as usePrevious,vn as useQueryBuilderSchema,xn as useQueryBuilderSelector,Tn as useQueryBuilderSetup,ro as useReactDndWarning,Sn as useRule,Nn as useRuleGroup,Pn as useSelectElementChangeHandler,xe as useStopEventPropagation,En as useValueEditor,Fn as useValueSelector};
//# sourceMappingURL=react-querybuilder.production.mjs.map